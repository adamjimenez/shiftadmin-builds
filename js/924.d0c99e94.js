"use strict";(self["webpackChunkshiftadmin"]=self["webpackChunkshiftadmin"]||[]).push([[924,961],{9498:function(e,t,a){a.d(t,{Z:function(){return h}});var o=a(3396),i=a(7139),s=a(870),l=a(6052),r=a(9457),n=a(2127),d=a(4193);function c(e,t,a,c,u,m){return(0,o.wg)(),(0,o.iD)("span",null,[(0,o.Wm)(s.T,{variant:"text",title:"Add",icon:"mdi-plus",to:m.base+"section/"+e.internalSection+"/add"+(a.parentsection?"?parentsection="+a.parentsection+"&parentid="+a.parentid:"")},null,8,["to"]),(0,o.Wm)(s.T,{variant:"text",title:"Fields",icon:"mdi-view-column",onClick:m.changeFields},null,8,["onClick"]),a.selected.length?((0,o.wg)(),(0,o.j4)(s.T,{key:0,variant:"text",title:"Delete",icon:"mdi-delete",onClick:t[0]||(t[0]=e=>m.doAction("delete"))})):(0,o.kq)("",!0),(0,o.Wm)(s.T,{variant:"text",title:"Import",icon:"mdi-import",onClick:m.openImport},null,8,["onClick"]),(0,o.Wm)(s.T,{variant:"text",title:"Export",icon:"mdi-export",onClick:m.exportItems},null,8,["onClick"]),a.sortable?((0,o.wg)(),(0,o.j4)(s.T,{key:1,variant:"text",title:"Sort",icon:"mdi-sort",onClick:m.openSortable},null,8,["onClick"])):(0,o.kq)("",!0),m.buttons.length?((0,o.wg)(),(0,o.j4)(d.T,{key:2},{activator:(0,o.w5)((({props:e})=>[(0,o.Wm)(s.T,(0,o.dG)({variant:"text"},e,{icon:"mdi-dots-vertical"}),null,16)])),default:(0,o.w5)((()=>[(0,o.Wm)(l.i,null,{default:(0,o.w5)((()=>[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(m.buttons,((e,t)=>((0,o.wg)(),(0,o.j4)(r.l,{key:t,value:t,onClick:t=>m.customButton(e)},{default:(0,o.w5)((()=>[(0,o.Wm)(n.V,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.label),1)])),_:2},1024)])),_:2},1032,["value","onClick"])))),128))])),_:1})])),_:1})):(0,o.kq)("",!0)])}a(560);var u={props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null,selected:null,data:null,headers:null,sortable:Boolean},data:function(){return{dialog:!1,selectedHeaders:[],internalSection:"",loading:!1}},methods:{formatString:function(e){return e=e.replace(/_/g," "),e.charAt(0).toUpperCase()+e.slice(1)},doAction:async function(e){this.$emit("custombutton",e)},exportItems:function(){this.$emit("custombutton","export")},changeFields:function(){this.$emit("changeFields")},openSortable:function(){this.$emit("openSortable")},customButton:function(e){this.$emit("custombutton",e)},openImport:function(){this.$emit("custombutton","import")}},watch:{section:function(e){this.internalSection=e}},computed:{buttons:function(){var e=[];return this.vars?.buttons?.forEach(((t,a)=>{"list"===t.page&&t.section===this.internalSection&&(t.id=a,e.push(t))})),e},base(){let e="/";return this.$route.params.base&&(e+=this.$route.params.base+"/"),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section}},m=a(89);const p=(0,m.Z)(u,[["render",c]]);var h=p},4961:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var o=a(3396),i=a(7139),s=a(7771),l=a(870),r=a(1489),n=a(1888),d=a(1334),c=a(6658),u=a(2934),m=a(2804),p=a(461),h=a(1231),g=a(7471),f=a(6969),v=a(8829),b=a(3890),y=a(7609),w=a(9207),S=a(2651),k=a(2864),V=a(6107),x=a(4870),C=a(3766),W=a(1107),_=a(9888);const P=(0,C.U)({itemsLength:{type:[Number,String],required:!0},...(0,w.Gj)(),...(0,c.Sz)(),...(0,u.p)()},"VDataTableServer"),I=(0,W.ev)()({name:"VDataTableServer",props:P(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,t){let{attrs:a,slots:i}=t;const{groupBy:s}=(0,f.my)(e),{sortBy:l,multiSort:r,mustSort:n}=(0,k.lx)(e),{page:d,itemsPerPage:c}=(0,w.FV)(e),C=(0,o.Fl)((()=>parseInt(e.itemsLength,10))),{columns:W,headers:P}=(0,v.IT)(e,{groupBy:s,showSelect:(0,x.Vh)(e,"showSelect"),showExpand:(0,x.Vh)(e,"showExpand")}),{items:I}=(0,b.hh)(e,W),{toggleSort:O}=(0,k.NV)({sortBy:l,multiSort:r,mustSort:n,page:d}),{opened:B,isGroupOpen:D,toggleGroup:H,extractRows:T}=(0,f.P_)({groupBy:s,sortBy:l}),{pageCount:U,setItemsPerPage:F}=(0,w.ku)({page:d,itemsPerPage:c,itemsLength:C}),{flatItems:$}=(0,f.T5)(I,s,B),{isSelected:j,select:E,selectAll:L,toggleSelect:Z,someSelected:A,allSelected:G}=(0,S.mH)(e,{allItems:I,currentPage:I}),{isExpanded:N,toggleExpand:q}=(0,g.BM)(e),J=(0,o.Fl)((()=>T(I.value)));(0,y.D)({page:d,itemsPerPage:c,sortBy:l,groupBy:s,search:(0,x.Vh)(e,"search")}),(0,o.JJ)("v-data-table",{toggleSort:O,sortBy:l}),(0,V.AF)({VDataTableRows:{hideNoData:(0,x.Vh)(e,"hideNoData"),noDataText:(0,x.Vh)(e,"noDataText"),loading:(0,x.Vh)(e,"loading"),loadingText:(0,x.Vh)(e,"loadingText")}});const z=(0,o.Fl)((()=>({page:d.value,itemsPerPage:c.value,sortBy:l.value,pageCount:U.value,toggleSort:O,setItemsPerPage:F,someSelected:A.value,allSelected:G.value,isSelected:j,select:E,selectAll:L,toggleSelect:Z,isExpanded:N,toggleExpand:q,isGroupOpen:D,toggleGroup:H,items:J.value.map((e=>e.raw)),internalItems:J.value,groupedItems:$.value,columns:W.value,headers:P.value})));(0,_.L)((()=>{const t=u.i.filterProps(e),s=m.I.filterProps(e),l=p.f.filterProps(e),r=h.Y.filterProps(e);return(0,o.Wm)(h.Y,(0,o.dG)({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},r),{top:()=>i.top?.(z.value),default:()=>i.default?i.default(z.value):(0,o.Wm)(o.HY,null,[i.colgroup?.(z.value),(0,o.Wm)("thead",{class:"v-data-table__thead",role:"rowgroup"},[(0,o.Wm)(m.I,(0,o.dG)(s,{sticky:e.fixedHeader}),i)]),i.thead?.(z.value),(0,o.Wm)("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[i["body.prepend"]?.(z.value),i.body?i.body(z.value):(0,o.Wm)(p.f,(0,o.dG)(a,l,{items:$.value}),i),i["body.append"]?.(z.value)]),i.tbody?.(z.value),i.tfoot?.(z.value)]),bottom:()=>i.bottom?i.bottom(z.value):(0,o.Wm)(u.i,t,{prepend:i["footer.prepend"]})})}))}});var O=a(3601),B=a(3121),D=a(9166),H=a(7396);const T=(0,C.U)({...(0,D.l)(),...(0,H.GB)()},"VLayout"),U=(0,W.ev)()({name:"VLayout",props:T(),setup(e,t){let{slots:a}=t;const{layoutClasses:i,layoutStyles:s,getLayoutItem:l,items:r,layoutRef:n}=(0,H.te)(e);return(0,_.L)((()=>(0,o.Wm)("div",{ref:n,class:[i.value,e.class],style:[s.value,e.style]},[a.default?.()]))),{getLayoutItem:l,items:r}}});var F=a(240),$=a(4286);const j={key:1},E=(0,o._)("h4",null,"Match up the fields",-1);function L(e,t,a,u,m,p){const h=(0,o.up)("ListButtons"),g=(0,o.up)("draggable");return(0,o.wg)(),(0,o.j4)(U,null,{default:(0,o.w5)((()=>[(0,o.Wm)(I,{modelValue:e.selected,"onUpdate:modelValue":t[2]||(t[2]=t=>e.selected=t),headers:p.activeHeaders,items:e.data.data,"item-value":"id","show-select":"","onClick:row":p.rowClick,loading:e.loading,"onUpdate:options":p.loadItems,"items-length":e.totalItems,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[3]||(t[3]=t=>e.itemsPerPage=t),search:e.search,"fixed-header":"","fixed-footer":"",class:"data-table-server"},{top:(0,o.w5)((()=>[(0,o.Wm)($.C,{color:"secondary",style:{position:"fixed","z-index":"100"},class:"w-100"},{default:(0,o.w5)((()=>[a.hidebuttons?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(h,{key:0,selected:e.selected,section:e.internalSection,onChangeFields:t[0]||(t[0]=t=>e.dialog=!0),onCustombutton:p.customButton,vars:a.vars,sortable:p.isSortable,onOpenSortable:t[1]||(t[1]=t=>e.sortableDialog=!0)},null,8,["selected","section","onCustombutton","vars","sortable"]))])),_:1})])),_:1},8,["modelValue","headers","items","onClick:row","loading","onUpdate:options","items-length","items-per-page","search"]),(0,o.Wm)(O.B,{modelValue:e.importDialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.importDialog=t),"max-width":"600",scrollable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r._,{title:"Import"},{default:(0,o.w5)((()=>[(0,o.Wm)(n.Z,null,{default:(0,o.w5)((()=>[e.error?((0,o.wg)(),(0,o.j4)(s.w,{key:0,text:e.error,type:"error"},null,8,["text"])):(0,o.kq)("",!0),(0,o.Wm)(B.Z,{modelValue:e.file,"onUpdate:modelValue":[t[4]||(t[4]=t=>e.file=t),p.readFile],label:"CSV file"},null,8,["modelValue","onUpdate:modelValue"]),e.importHeaders.length?((0,o.wg)(),(0,o.iD)("div",j,[E,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.headers,((t,a)=>((0,o.wg)(),(0,o.iD)("div",{key:a},[(0,o.Wm)(F.rL,{items:e.importHeaders,label:t.title,modelValue:e.importCols[t.key],"onUpdate:modelValue":a=>e.importCols[t.key]=a},null,8,["items","label","modelValue","onUpdate:modelValue"])])))),128))])):(0,o.kq)("",!0)])),_:1}),(0,o.Wm)(d.h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l.T,{onClick:p.doImport,variant:"flat",color:"primary",disabled:!e.importHeaders.length},{default:(0,o.w5)((()=>[(0,o.Uk)("Import")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(O.B,{modelValue:e.dialog,"onUpdate:modelValue":t[7]||(t[7]=t=>e.dialog=t),"max-width":"600",scrollable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r._,{title:"Fields"},{default:(0,o.w5)((()=>[(0,o.Wm)(c.y_,{modelValue:e.selectedHeaders,"onUpdate:modelValue":t[6]||(t[6]=t=>e.selectedHeaders=t),headers:[{title:"Field",key:"key"}],items:e.headers,"item-value":"key","items-per-page":"-1","show-select":"",class:"text-capitalize"},{bottom:(0,o.w5)((()=>[])),_:1},8,["modelValue","items"])])),_:1})])),_:1},8,["modelValue"]),(0,o.Wm)(O.B,{modelValue:e.sortableDialog,"onUpdate:modelValue":t[11]||(t[11]=t=>e.sortableDialog=t),"max-width":"600",scrollable:""},{default:(0,o.w5)((()=>[(0,o.Wm)(r._,{title:"Sort Order",loading:e.sortOrderLoading},{default:(0,o.w5)((()=>[(0,o.Wm)(n.Z,null,{default:(0,o.w5)((()=>[(0,o.Wm)(g,{modelValue:e.sortOrder,"onUpdate:modelValue":t[8]||(t[8]=t=>e.sortOrder=t),group:"items",onStart:t[9]||(t[9]=t=>e.drag=!0),onEnd:t[10]||(t[10]=t=>e.drag=!1),"item-key":"id"},{item:(0,o.w5)((({element:e})=>[(0,o.Wm)($.C,{color:"primary",class:"ma-5 pa-5"},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.title),1)])),_:2},1024)])),_:1},8,["modelValue"])])),_:1}),(0,o.Wm)(d.h,null,{default:(0,o.w5)((()=>[(0,o.Wm)(l.T,{variant:"flat",color:"primary",onClick:p.saveSortOrder},{default:(0,o.w5)((()=>[(0,o.Uk)("Save")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:1})}a(560);var Z=a(1006),A=a(2564),G=a(5410),N=a.n(G),q=a(9498),J=a(6983),z=a.n(J),R={components:{ListButtons:q.Z,draggable:z()},props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null},data:function(){return{dialog:!1,selectedHeaders:[],selected:[],data:[],internalSection:"",loading:!1,importDialog:!1,importHeaders:[],importCols:{},sortableDialog:!1,totalItems:0,itemsPerPage:20,search:"",headers:[],drag:!1,sortOrder:[],sortOrderLoading:!1,file:[],error:""}},methods:{formatString:function(e){return e=e.replace(/_/g," "),e.charAt(0).toUpperCase()+e.slice(1)},loadItems:async function({page:e,itemsPerPage:t,sortBy:a}){var o={cmd:"get",section:this.internalSection,fields:this.searchparams,page:e,itemsPerPage:t,sortBy:a};this.parentsection&&(o.parentsection=this.parentsection),this.parentid&&(o.parentid=this.parentid);const i=N().stringify(o);this.loading=!0;let s={};try{s=await Z.Z.get("?"+i.toString(),o)}catch(r){console.log(r)}if(this.loading=!1,!s.data?.fields)return!1;s.data.data||(s.data.data=[],s.data.total=0),s.data.data.forEach((e=>{for(const[,t]of Object.entries(s.data.fields))e[t.column]=A.Z.formatData(e[t.column],t.type)})),this.data=s.data,this.totalItems=this.data.total,this.headers=[];let l=Object.values(s.data.fields);if(l.length&&!l.find((e=>"id"===e.column)))return this.$router.push(this.base+"section/"+this.internalSection+"/1/"),!1;for(const[,n]of Object.entries(this.data.fields))this.headers.push({title:this.formatString(n.column),key:n.column});this.selectedHeaders.length||(this.selectedHeaders=l.map((e=>e.column))),this.$emit("changeHeaders",l),this.sortOrder=[],this.isSortable&&(this.data.data.forEach((e=>{let t=Object.keys(e)[0];this.sortOrder.push({title:t+": "+e[t],id:e.id,position:e.position})})),this.sortOrder.sort(((e,t)=>e.position-t.position)))},rowClick:function(e,t){let a="/";this.$route.params.base&&(a+=this.$route.params.base+"/"),this.$router.push(a+"section/"+this.internalSection+"/"+t.item.id+"/")},doAction:async function(e){var t={cmd:e,section:this.section,ids:this.selected};this.loading=!0,await Z.Z.post("?cmd="+e+"&section="+this.internalSection,t),this.selected=[],this.reload()},customButton:async function(e){let t={};if("export"===e)return void this.exportItems();if("import"===e)return void this.openImport();if("string"===typeof e)return t={cmd:e,section:this.internalSection,ids:this.selected},this.loading=!0,await Z.Z.post("?cmd="+e+"&section="+this.internalSection,t),void this.reload();t={cmd:"button",button:e.id,section:this.internalSection,ids:this.selected},this.loading=!0;const a=await Z.Z.post("?cmd=button&section="+this.internalSection,t);this.loading=!1,a.data.error&&alert(a.data.error),a.data.result?.redirect?e.target?window.open(a.data.result.redirect):location.href=a.data.result.redirect:this.reload()},exportItems:function(){var e={cmd:"export",section:this.internalSection,fields:this.searchparams,columns:this.activeHeaders.map((e=>e.key))};this.parentsection&&(e.parentsection=this.parentsection),this.parentid&&(e.parentid=this.parentid);const t=N().stringify(e);window.open(Z.Z.getApiRoot()+"?"+t)},openImport:function(){this.importDialog=!0},doImport:async function(){const e=new FormData;for(const[a,o]of Object.entries(this.importCols))e.append("fields["+a+"]",o);e.append("file",this.file[0]),this.error="",this.loading=!0;const t=await Z.Z.post("?cmd=import&section="+this.internalSection,e,{headers:{"Content-Type":"multipart/form-data"}});this.loading=!1,t.data.error?this.error=t.data?.error:(this.importDialog=!1,this.reload())},saveSortOrder:async function(){var e={cmd:"reorder",section:this.section,items:this.sortOrder};this.sortOrderLoading=!0,await Z.Z.post("?cmd=reorder&section="+this.internalSection,e),this.sortOrderLoading=!1,this.sortableDialog=!1,this.reload()},reload:function(){this.search=String(Date.now())},readFile:function(){const e=new FileReader;e.onload=e=>{const t=e.target.result,a=t.split("\n");let o=[],i=a[0].split(",");for(let l=0;l<i.length;l++){const e=i[l].trim();e.startsWith('"')&&e.endsWith('"')?o.push(e.slice(1,-1)):o.push(e)}let s=[];i=a[1].split(",");for(let l=0;l<i.length;l++){const e=i[l].trim();e.startsWith('"')&&e.endsWith('"')?s.push(e.slice(1,-1)):s.push(e)}this.importHeaders=[],o.forEach(((e,t)=>{this.importHeaders.push({value:t,raw:e,title:e+" - "+s[t]})})),this.importCols={},this.headers.forEach((e=>{let t=this.importHeaders.find((t=>t.raw===e.key));this.importCols[e.key]=t?t.value:""}))},e.readAsText(this.file[0])}},watch:{$route(e){this.internalSection=e.params.section,this.reload()},section:function(e){this.internalSection=e,this.reload()},selectedHeaders:function(e){localStorage["fields_"+this.internalSection]=JSON.stringify(Object.values(e))},searchparams:function(){this.reload()},headers:function(e){let t=localStorage["fields_"+this.internalSection],a=t?JSON.parse(t):e.map((e=>e.key));JSON.stringify(a)!==JSON.stringify(this.selectedHeaders)&&(this.selectedHeaders=a);var o=[];this.selectedHeaders.forEach((e=>{for(const[,t]of Object.entries(this.data.fields))e===t.column&&o.push(t)})),this.$emit("changeFields",o)},vars:function(){}},computed:{activeHeaders:function(){var e=[];return this.selectedHeaders.forEach((function(t){e.push({title:t,value:t,sortable:!0})})),e},isSortable:function(){let e=!1;return this.data.fields&&Object.values(this.data.fields).forEach((t=>{"position"===t.type&&(e=!0)})),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section,localStorage["fields_"+this.internalSection]&&(this.selectedHeaders=JSON.parse(localStorage["fields_"+this.internalSection]))},mounted(){this.hidebuttons||(document.title="ADMIN | "+this.internalSection)}},Y=a(89);const M=(0,Y.Z)(R,[["render",L]]);var K=M}}]);
//# sourceMappingURL=924.d0c99e94.js.map