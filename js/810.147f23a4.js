"use strict";(self["webpackChunkshiftadmin"]=self["webpackChunkshiftadmin"]||[]).push([[810],{17810:function(e,t,a){a.r(t),a.d(t,{default:function(){return Z}});a(44114),a(98992),a(54520),a(72577),a(3949),a(81454);var l=a(56768),i=a(24232),o=a(45130),n=a(90144),s=a(47664),r=a(74300),u=a(27274),d=a(19122),c=a.n(d),h=a(31969),m=a(13892),p=a(4189),f=a(93745),g=a(47697),b=a(91772),v=a(78351),y=a(67020),k=a(57254),F=a(43948);function w(e,t,a,i,o,n){return(0,l.uX)(),(0,l.CE)("span",null,[(0,l.bF)(k.g,{title:"File uploads","prepend-icon":"mdi-file-upload",onClick:n.open},null,8,["onClick"]),(0,l.bF)(b.p,{modelValue:e.dialog,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dialog=t),scrollable:""},{default:(0,l.k6)((()=>[(0,l.bF)(p.J,null,{default:(0,l.k6)((()=>[e.error?((0,l.uX)(),(0,l.Wv)(h.l,{key:0,title:e.error,type:"error"},null,8,["title"])):(0,l.Q3)("",!0),(0,l.bF)(f.S,null,{default:(0,l.k6)((()=>[(0,l.bF)(m.D,{title:"Create folder",icon:"mdi-folder-outline",onClick:n.createFolder},null,8,["onClick"]),(0,l.bF)(m.D,{title:"Delete",icon:"mdi-delete",disabled:0===e.selected.length,onClick:n.deleteItems},null,8,["disabled","onClick"]),(0,l.bF)(v.f,{modelValue:e.file,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.file=t),n.uploadFile],multiple:"","prepend-icon":"mdi-upload","hide-details":"",class:"hide-input mx-3"},null,8,["modelValue","onUpdate:modelValue"]),(0,l.bF)(m.D,{title:"Up level",disabled:"/"===e.path,icon:"mdi-arrow-up",onClick:n.upLevel},null,8,["disabled","onClick"]),(0,l.bF)(F.W,{modelValue:e.path,"onUpdate:modelValue":t[1]||(t[1]=t=>e.path=t),"hide-details":"",readonly:"",density:"compact"},null,8,["modelValue"]),(0,l.bF)(F.W,{modelValue:e.filter,"onUpdate:modelValue":t[2]||(t[2]=t=>e.filter=t),"hide-details":"",density:"compact","prepend-inner-icon":"mdi-magnify",class:"ml-3"},null,8,["modelValue"])])),_:1}),(0,l.bF)(g.Py,{items:n.filteredItems,headers:e.headers,"show-select":"",modelValue:e.selected,"onUpdate:modelValue":t[3]||(t[3]=t=>e.selected=t),"onClick:row":n.rowClick,loading:e.loading},{["item.thumb"]:(0,l.k6)((({item:t})=>[t.thumb?((0,l.uX)(),(0,l.Wv)(y.y,{key:0,src:e.apiRoot+"?cmd=file&f="+t.id,style:{"max-width":"160px","max-height":"120px"}},null,8,["src"])):(0,l.Q3)("",!0)])),_:2},1032,["items","headers","modelValue","onClick:row","loading"])])),_:1})])),_:1},8,["modelValue"])])}var D={data:function(){return{column:"",dialog:!1,items:[],path:"/",headers:[{title:"Name",value:"name"},{title:"Thumb",value:"thumb"}],apiRoot:"",selected:[],loading:!1,file:[],error:"",filter:""}},methods:{fetchData:async function(){this.loading=!0;const e=await r.A.get("?cmd=uploads&path="+this.path);e.data.error&&(this.error=e.data.error),this.loading=!1,this.items=e.data.items},open:function(e){this.column=e,this.dialog=!0,this.fetchData()},rowClick:function(e,t){if(t.item.leaf){let e=t.item.id;this.selectFile(e)}else this.path=t.item.id+"/",this.fetchData()},selectFile:function(e){"function"===typeof this.column?(e="/uploads"+e,this.column(e,{title:e}),this.dialog=!1):this.column&&(this.$emit("fileSelected",{value:e.substr(1),column:this.column}),this.dialog=!1)},upLevel:function(){let e=this.path.substr(0,this.path.length-1).lastIndexOf("/");-1!==e&&(this.path=this.path.substr(0,e+1)),this.fetchData()},createFolder:async function(){let e=prompt("Folder name");if(!e)return;this.loading=!0;const t=await r.A.post("?cmd=uploads&path="+this.path,{createFolder:e});this.loading=!1,t.data.error&&(this.error=t.data.error),this.fetchData()},deleteItems:async function(){if(!confirm("Are you sure?"))return;this.loading=!0;const e=await r.A.post("?cmd=uploads&path="+this.path,{delete:this.selected});this.loading=!1,e.data.error&&(this.error=e.data.error),this.fetchData()},uploadFile:async function(){console.log(this.file);const e=new FormData;this.file.forEach((function(t){console.log("File details:",t),e.append("file",t)})),this.loading=!0;const t=await r.A.post("?cmd=uploads&path="+this.path,e,{headers:{"Content-Type":"multipart/form-data"}});this.loading=!1,t.data?.error&&alert(t.data?.error),await this.fetchData(),this.selectFile(t.data.file.path)}},computed:{filteredItems:function(){const e=[];return this.items.forEach((t=>{-1!==t.name.indexOf(this.filter)&&e.push(t)})),e}},async mounted(){this.apiRoot=r.A.getApiRoot()}},V=a(71241);const _=(0,V.A)(D,[["render",w]]);var C=_,S=a(59471),W=a(68353),X=a(73416),$=a(69915),U=a(88249);function A(e,t,a,n,s,r){return(0,l.uX)(),(0,l.Wv)(U.q,{modelValue:e.opened,"onUpdate:modelValue":t[2]||(t[2]=t=>e.opened=t)},{activator:(0,l.k6)((({props:e})=>[(0,l.bF)(m.D,(0,l.v6)({color:"primary"},e,{onClick:t[0]||(t[0]=(0,o.D$)((()=>{}),["stop"])),onMousedown:t[1]||(t[1]=(0,o.D$)((()=>{}),["stop"]))}),{default:(0,l.k6)((()=>[(0,l.bF)(X.y,{color:"primary"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(a.user?.initials?a.user.initials:"??"),1)])),_:1})])),_:2},1040)])),default:(0,l.k6)((()=>[(0,l.bF)($.x8,null,{default:(0,l.k6)((()=>[(0,l.bF)(k.g,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(a.user.name),1)])),_:1}),(0,l.bF)(k.g,{onClick:r.logout,title:"Logout","prepend-icon":"mdi-logout"},null,8,["onClick"])])),_:1})])),_:1},8,["modelValue"])}var x={props:{user:null},data:function(){return{opened:!1}},methods:{logout:async function(){await r.A.post("?cmd=logout"),this.$router.push(u.A.base()+"login")}}};const R=(0,V.A)(x,[["render",A]]);var P=R,E=a(96450),Q=a(30249),I=a(58332),O=a(3462),M=a(91606),T=a(30697),j=a(20396),L=a(7511),H=a(41720),K=a(79669),Y=a(4529),q=a(98477),N=a(70373);const J={key:2,class:"text-align-center w-100 d-flex flex-row justify-center"},B={name:"GenieAdmin",components:{FileUploads:C,SearchField:S.A,AccountButton:P},data:function(){return{section:"",search:null,searchItems:[],drawer:!0,rail:!0,vars:{},data:{},user:{},advancedDialog:!1,fields:[],headers:[],params:{func:{}},searchParams:{},searchable:["checkbox","combo","date","datetime","decimal","deleted","email","id","int","page_name","rating","select","select_parent","select_multiple","tel","text","timestamp"],fileSelected:{},fullScreen:!1,display:{},searchFocussed:!1,ignoreChange:!1,child:{}}},methods:{afterSelection:function(e){"object"===typeof e&&null!==e&&this.goToRecord(e.value)},goToRecord(e){this.$router.push(this.base+"section/"+this.section+"/"+e+"/")},updateSearch:async function(){if(null!==this.search&&"object"===typeof this.search)return;let e={cmd:"get",section:this.$route.params.section,fields:{s:this.search},itemsPerPage:10,columns:this.fields.map((e=>e.column))};const t=c().stringify(e);this.loading=!0,this.error="";let a={};try{a=await r.A.get("?"+t.toString(),e)}catch(i){console.log(i)}a.data.error&&(this.error=a.data.error),this.loading=!1;let l=[];a.data.data.forEach((e=>{let t="";for(const[a,l]of Object.entries(e)){let e=this.fields.find((e=>e.column===a));l&&["text"].includes(e?.type)&&(t&&(t+=", "),t+=l)}l.push({value:e.id,title:t})})),this.searchItems=l},updateFunc:function(e,t){this.params.func[e]=t},quickSearch:function(){this.searchParams={s:this.search}},doSearch:function(){let e={};for(const[t,a]of Object.entries(this.params))["parentsection","parentid"].includes(t)||"undefined"===typeof a||(e[t]=a);console.log("do search update params"),this.searchParams=e,this.advancedDialog=!1},saveSearch:async function(){let e=prompt("Name this filter");if(!e)return;let t={save:1,label:e,section:this.section,conditions:this.searchParams};await r.A.post("?cmd=filters",t),this.advancedDialog=!1,this.fetchData()},advancedSearch:async function(){this.params.func||(this.params.func={}),this.advancedDialog=!0},changeFields:function(e){this.fields=e},changeHeaders:function(e){this.headers=e},fetchData:async function(){let e={};try{e=await r.A.get("?cmd=config")}catch(i){console.log(i)}let t=e.data;if(t?.vars&&t.vars.subsections)for(let[o,n]of Object.entries(t.vars.subsections))n.forEach(((e,a)=>{"string"===typeof e&&(t.vars.subsections[o][a]={title:this.formatString(e),subsection:e})}));this.vars=t?.vars,this.user=t?.user;let a={primary:"#007bff",secondary:"#303641"};this.$vuetify.theme.themes.light.colors={...this.$vuetify.theme.themes.light.colors,...a,...this.vars?.branding?.colors},this.$vuetify.theme.themes.dark.colors={...this.$vuetify.theme.themes.dark.colors,...a,...this.vars?.branding?.colors};let l=this.vars?.branding?.title?this.vars.branding.title:"ADMIN";document.title||(document.title=l)},deleteFilter:async function(e){confirm("Are you sure?")&&(await r.A.post("?cmd=filters",{delete:e}),this.fetchData())},openReport:function(e){this.$router.push(this.base+"reports/"+e)},deleteReport:async function(e){confirm("Are you sure?")&&(await r.A.post("?cmd=reports",{delete:e}),this.fetchData(),this.$route.fullPath===this.base+"reports/"+e&&this.$router.push(this.base))},chooseFileUpload:function(e){this.$refs["fileUploads"].open(e)},fileSelectedHandler:function(e){this.fileSelected=e},message:function(e){console.log(e),"boolean"===typeof e.fullScreen&&(this.fullScreen=e.fullScreen)},formatString:function(e){return u.A.formatString(e)},updateCount:function(e){this.vars?.menu?.forEach((t=>{t.children?.forEach((t=>{location.href.endsWith(t.to)&&(t.count=e.total)}))}))},onSearchFocus:function(){this.mobile&&(this.searchFocussed=!0)}},watch:{$route:async function(){if("Unlicensed"===u.A.getEdition())return void this.$router.push(u.A.base()+"upgrade");let e=this.$route.query;e&&(this.params=e,this.ignoreChange=!0,this.searchParams=e,await this.$nextTick(),this.ignoreChange=!1),this.$route.params.section!==this.section&&(this.section=this.$route.params.section,this.search=this.params.s,this.headers=[])},searchParams:async function(e){if(this.ignoreChange||!this.$route.params.section)return;let t={};for(const[a,l]of Object.entries(e))["parentsection","parentid"].includes(a)||"undefined"===typeof l||(t[a]=l);Object.values(t).length&&await this.$router.push({path:this.base+"section/"+this.$route.params.section,query:t,force:!0})},mobile(e){this.rail=!e,this.drawer=!e},rail(e){localStorage.rail=e},advancedDialog(e){!1===e&&(this.searchFocussed=!1)}},computed:{base(){return u.A.base()},searchParamCount(){return Object.keys(this.searchParams).filter((e=>!["func","s"].includes(e)&&"undefined"!==typeof this.searchParams[e])).length},edition(){return u.A.getEdition()},mobile:function(){return this.display},showSearch:function(){return this.headers.find((e=>"id"===e.type))||!1}},async mounted(){const{mobile:e}=(0,W._F)();this.display=e,await this.$router.isReady();let t=this.$route.query;t&&(this.params=t,this.searchParams=t,this.search=this.params.s),this.$route.params.section&&(this.section=this.$route.params.section),await this.fetchData(),"false"===localStorage.rail&&(this.rail=!1)}};var z=Object.assign(B,{setup(e){const t=(0,s.DP)();return window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",(e=>{const a=e.matches?"dark":"light";t.global.name.value=a})),(e,t)=>{const a=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.Wv)(E.E,{class:(0,i.C4)(e.mobile?"mobile":"desktop")},{default:(0,l.k6)((()=>[(0,l.bF)(Q.z,{color:"secondary"},{default:(0,l.k6)((()=>[e.mobile&&e.showSearch?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(I.Z,{key:0,variant:"text",color:"grey-lighten-1",onClick:t[0]||(t[0]=(0,o.D$)((t=>{e.mobile?e.drawer=!e.drawer:e.rail=!e.rail}),["stop"]))})),e.mobile?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(m.D,{key:1,to:e.base,variant:"plain"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.vars?.branding?.title?e.vars.branding.title:"Admin"),1)])),_:1},8,["to"])),e.showSearch?((0,l.uX)(),(0,l.CE)("div",J,[e.section&&e.fields.length?((0,l.uX)(),(0,l.Wv)(j.A,{key:0,modelValue:e.search,"onUpdate:modelValue":[t[6]||(t[6]=t=>e.search=t),e.afterSelection],items:e.searchItems,"onUpdate:search":e.updateSearch,onKeydown:(0,o.jR)(e.quickSearch,["enter"]),ref:"autocomplete","hide-details":"","hide-no-data":"","single-line":"",rounded:"",variant:"solo-filled","no-filter":"",class:"mx-5",style:{"max-width":"800px"},label:"Search "+e.section,placeholder:"Search "+e.section,onFocus:e.onSearchFocus},{"prepend-inner":(0,l.k6)((()=>[e.searchFocussed?((0,l.uX)(),(0,l.Wv)(K.w,{key:0,icon:"mdi:mdi-arrow-left",onClick:t[1]||(t[1]=(0,o.D$)((t=>e.searchFocussed=!1),["stop"])),onMousedown:t[2]||(t[2]=(0,o.D$)((()=>{}),["stop"]))})):e.mobile?((0,l.uX)(),(0,l.Wv)(I.Z,{key:1,color:"grey-lighten-1",onClick:t[3]||(t[3]=(0,o.D$)((t=>{e.mobile?e.drawer=!e.drawer:e.rail=!e.rail}),["stop"])),onMousedown:t[4]||(t[4]=(0,o.D$)((()=>{}),["stop"]))})):((0,l.uX)(),(0,l.Wv)(K.w,{key:2,icon:"mdi:mdi-magnify"}))])),"append-inner":(0,l.k6)((()=>[e.mobile&&!e.searchFocussed?((0,l.uX)(),(0,l.Wv)(P,{key:0,user:e.user},null,8,["user"])):((0,l.uX)(),(0,l.Wv)(m.D,{key:1,color:"grey-lighten-1",onMousedown:t[5]||(t[5]=(0,o.D$)((()=>{}),["stop"])),onClick:(0,o.D$)(e.advancedSearch,["stop"]),disabled:0===e.fields.length,icon:""},{default:(0,l.k6)((()=>[e.searchParamCount>0?((0,l.uX)(),(0,l.Wv)(O.Q,{key:0,content:e.searchParamCount,color:"info"},{default:(0,l.k6)((()=>[(0,l.bF)(K.w,{icon:"mdi-tune"})])),_:1},8,["content"])):((0,l.uX)(),(0,l.Wv)(K.w,{key:1,icon:"mdi-tune"}))])),_:1},8,["onClick","disabled"]))])),item:(0,l.k6)((({item:t,props:a})=>[(0,l.bF)(k.g,(0,l.v6)(a,{onMousedown:(0,o.D$)((a=>e.goToRecord(t.value)),["stop"])}),null,16,["onMousedown"])])),_:1},8,["modelValue","items","onUpdate:search","onUpdate:modelValue","onKeydown","label","placeholder","onFocus"])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0),e.mobile&&e.showSearch?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(H.h,{key:3})),e.mobile&&e.showSearch?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(P,{key:4,user:e.user},null,8,["user"]))])),_:1}),(0,l.bF)(N.e,{modelValue:e.drawer,"onUpdate:modelValue":t[7]||(t[7]=t=>e.drawer=t),rail:e.rail,"expand-on-hover":"",permanent:!e.mobile,color:"secondary"},{default:(0,l.k6)((()=>[(0,l.bF)($.x8,null,{default:(0,l.k6)((()=>[e.mobile?((0,l.uX)(),(0,l.Wv)(k.g,{key:0,to:e.base,"prepend-icon":"mdi-home"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(e.vars?.branding?.title?e.vars.branding.title:"Admin"),1)])),_:1},8,["to"])):(0,l.Q3)("",!0),"Business"!==e.edition?((0,l.uX)(),(0,l.Wv)(k.g,{key:1,title:"Upgrade","prepend-icon":"mdi-rocket-launch",to:e.base+"upgrade","base-color":"red"},null,8,["to"])):(0,l.Q3)("",!0),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.vars?.menu,(t=>((0,l.uX)(),(0,l.CE)("div",{key:t},[t.children?((0,l.uX)(),(0,l.Wv)(Y.K,{key:0,"prepend-icon":t.icon?t.icon:"mdi-minus",value:t.title},{activator:(0,l.k6)((({props:e})=>[(0,l.bF)(k.g,(0,l.v6)({ref_for:!0},e,{title:t.title}),null,16,["title"])])),default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(t.children,(t=>((0,l.uX)(),(0,l.Wv)(k.g,{key:t.to,title:t.title,value:t.to,to:t.target_blank?t.to:e.base+t.to,target:t.target_blank?"_blank":""},{prepend:(0,l.k6)((()=>[t?.count>0?((0,l.uX)(),(0,l.Wv)(O.Q,{key:0,content:parseInt(t?.count).toLocaleString(),color:"error"},{default:(0,l.k6)((()=>[(0,l.bF)(K.w,{icon:t.icon?t.icon:"mdi-minus"},null,8,["icon"])])),_:2},1032,["content"])):((0,l.uX)(),(0,l.Wv)(K.w,{key:1,icon:t.icon?t.icon:"mdi-minus"},null,8,["icon"]))])),append:(0,l.k6)((()=>[t.filter_id?((0,l.uX)(),(0,l.Wv)(m.D,{key:0,icon:"mdi-delete",onClick:(0,o.D$)((a=>e.deleteFilter(t.filter_id)),["stop"]),variant:"text",size:"x-small"},null,8,["onClick"])):(0,l.Q3)("",!0)])),_:2},1032,["title","value","to","target"])))),128))])),_:2},1032,["prepend-icon","value"])):((0,l.uX)(),(0,l.Wv)(k.g,{key:1,title:t.title,value:t.to,to:t.target_blank?t.to:e.base+t.to,target:t.target_blank?"_blank":""},{prepend:(0,l.k6)((()=>[t?.count>0?((0,l.uX)(),(0,l.Wv)(O.Q,{key:0,content:parseInt(e.child?.count).toLocaleString(),color:"error"},{default:(0,l.k6)((()=>[(0,l.bF)(K.w,{icon:t.icon?t.icon:"mdi-minus"},null,8,["icon"])])),_:2},1032,["content"])):((0,l.uX)(),(0,l.Wv)(K.w,{key:1,icon:t.icon?t.icon:"mdi-minus"},null,8,["icon"]))])),_:2},1032,["title","value","to","target"]))])))),128)),(0,l.bF)(Y.K,{"prepend-icon":"mdi-chart-line",value:"Reports"},{activator:(0,l.k6)((({props:e})=>[(0,l.bF)(k.g,(0,l.v6)(e,{title:"Reports"}),null,16)])),default:(0,l.k6)((()=>[(0,l.bF)(k.g,{title:"New","prepend-icon":"mdi-plus",to:e.base+"reports/0"},null,8,["to"]),((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.vars?.reports,(t=>((0,l.uX)(),(0,l.Wv)(k.g,{key:t.to,title:t.title,"prepend-icon":"mdi-minus",onClick:a=>e.openReport(t.id)},{append:(0,l.k6)((()=>[t.id?((0,l.uX)(),(0,l.Wv)(m.D,{key:0,icon:"mdi-delete",onClick:(0,o.D$)((a=>e.deleteReport(t.id)),["stop"]),variant:"text",size:"x-small"},null,8,["onClick"])):(0,l.Q3)("",!0)])),_:2},1032,["title","onClick"])))),128))])),_:1}),1===e.user?.admin||e.user?.privileges?.uploads>0?((0,l.uX)(),(0,l.Wv)((0,n.R1)(C),{key:2,ref:"fileUploads",onFileSelected:e.fileSelectedHandler},null,8,["onFileSelected"])):(0,l.Q3)("",!0),1===e.user?.admin?((0,l.uX)(),(0,l.Wv)(k.g,{key:3,title:"Configure","prepend-icon":"mdi-cog",to:e.base+"configure"},null,8,["to"])):(0,l.Q3)("",!0)])),_:1})])),_:1},8,["modelValue","rail","permanent"]),(0,l.bF)(q.Y,{class:"d-flex flex-column align-center justify-center"},{default:(0,l.k6)((()=>[(0,l.bF)(a,{ref:"main",class:(0,i.C4)(["w-100 flex-grow-1",e.fullScreen?"fullScreen":""]),vars:e.vars,searchparams:e.searchParams,onChangeFields:e.changeFields,onChangeHeaders:e.changeHeaders,onChooseFileUpload:e.chooseFileUpload,fileSelected:e.fileSelected,onMessage:e.message,mobile:e.mobile,onConfigUpdated:e.fetchData,onUpdateCount:e.updateCount},null,8,["vars","searchparams","onChangeFields","onChangeHeaders","onChooseFileUpload","fileSelected","onMessage","class","mobile","onConfigUpdated","onUpdateCount"])])),_:1}),(0,l.bF)(b.p,{modelValue:e.advancedDialog,"onUpdate:modelValue":t[8]||(t[8]=t=>e.advancedDialog=t),"max-width":"600",scrollable:""},{default:(0,l.k6)((()=>[(0,l.bF)(p.J,null,{default:(0,l.k6)((()=>[(0,l.bF)(M.r,null,{default:(0,l.k6)((()=>[(0,l.eW)("Search "+(0,i.v_)(e.section),1)])),_:1}),(0,l.bF)(L.G),(0,l.bF)(T.O,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.fields,(t=>((0,l.uX)(),(0,l.CE)(l.FK,{key:t.type},[e.searchable.includes(t.type)?((0,l.uX)(),(0,l.Wv)(k.g,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)((0,n.R1)(S.A),{column:t.column,type:t.type,optionConfig:e.vars.options,label:e.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,func:e.params?.func?.[t.column],onUpdateFunc:e.updateFunc},null,8,["column","type","optionConfig","label","modelValue","onUpdate:modelValue","func","onUpdateFunc"])])),_:2},1024)):(0,l.Q3)("",!0)],64)))),128))])),_:1}),(0,l.bF)(f.S,null,{default:(0,l.k6)((()=>[(0,l.bF)(H.h),(0,l.bF)(m.D,{onClick:e.saveSearch,color:"primary",variant:"plain"},{default:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.eW)("Create filter")]))),_:1},8,["onClick"]),(0,l.bF)(m.D,{onClick:e.doSearch,color:"primary",variant:"flat"},{default:(0,l.k6)((()=>t[10]||(t[10]=[(0,l.eW)("Search")]))),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["class"])}}});const G=z;var Z=G},59471:function(e,t,a){a.d(t,{A:function(){return U}});var l=a(56768),i=a(24232),o=a(92239),n=a(13892),s=a(71233),r=a(20105),u=a(43948);const d={key:0,class:"mb-1"};function c(e,t,a,c,h,m){const p=(0,l.g2)("DateRange");return(0,l.uX)(),(0,l.CE)("span",null,[["checkbox","deleted"].includes(a.type)?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",null,(0,i.v_)(a.label),1),(0,l.bF)(s.H_,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=t=>e.value=t),divided:""},{default:(0,l.k6)((()=>[(0,l.bF)(n.D,{value:"1"},{default:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.eW)(" Yes ")]))),_:1}),(0,l.bF)(n.D,{value:"0"},{default:(0,l.k6)((()=>t[10]||(t[10]=[(0,l.eW)(" No ")]))),_:1})])),_:1},8,["modelValue"])])):["select"].includes(a.type)?((0,l.uX)(),(0,l.Wv)(r.d4,{key:1,label:a.label,items:e.options,modelValue:e.value,"onUpdate:modelValue":t[1]||(t[1]=t=>e.value=t),clearable:""},null,8,["label","items","modelValue"])):["select_multiple"].includes(a.type)?((0,l.uX)(),(0,l.Wv)(r.d4,{key:2,label:a.label,items:e.options,modelValue:e.value,"onUpdate:modelValue":t[3]||(t[3]=t=>e.value=t),multiple:"",chips:"",clearable:""},{prepend:(0,l.k6)((()=>[(0,l.bF)(r.d4,{modelValue:e.localFunc,"onUpdate:modelValue":t[2]||(t[2]=t=>e.localFunc=t),items:["in","not in"],"hide-details":""},null,8,["modelValue"])])),_:1},8,["label","items","modelValue"])):"combo"===a.type?((0,l.uX)(),(0,l.Wv)(o.V,{key:3,label:a.label,modelValue:e.value,"onUpdate:modelValue":t[4]||(t[4]=t=>e.value=t),items:e.options,"onUpdate:search":t[5]||(t[5]=e=>m.updateCombo(e,a.column))},null,8,["label","modelValue","items"])):["date","datetime","timestamp"].includes(a.type)?((0,l.uX)(),(0,l.Wv)(p,{key:4,label:a.label,modelValue:e.value,"onUpdate:modelValue":t[6]||(t[6]=t=>e.value=t)},null,8,["label","modelValue"])):((0,l.uX)(),(0,l.Wv)(u.W,{key:5,label:a.label,modelValue:e.value,"onUpdate:modelValue":t[8]||(t[8]=t=>e.value=t),type:m.fieldType(a.type),step:m.fieldStep(a.type)},(0,l.eX)({_:2},[["id","decimal","int","rating"].includes(a.type)?{name:"prepend",fn:(0,l.k6)((()=>[(0,l.bF)(r.d4,{modelValue:e.localFunc,"onUpdate:modelValue":t[7]||(t[7]=t=>e.localFunc=t),items:["=",">","<"],"hide-details":""},null,8,["modelValue"])])),key:"0"}:void 0]),1032,["label","modelValue","type","step"]))])}var h=a(74300),m=a(27274),p=a(4189),f=a(8483),g=a(43813),b=a(56756),v=a(35526),y=a(69915),k=a(57254),F=a(88249);function w(e,t,a,o,n,s){return(0,l.uX)(),(0,l.Wv)(F.q,{ref:"menu",modelValue:e.menu,"onUpdate:modelValue":t[3]||(t[3]=t=>e.menu=t),"close-on-content-click":!1,transition:"scale-transition","offset-y":""},{activator:(0,l.k6)((({props:e})=>[(0,l.bF)(u.W,(0,l.v6)({modelValue:s.dateRangeText,"onUpdate:modelValue":t[0]||(t[0]=e=>s.dateRangeText=e),label:a.label,readonly:""},e),null,16,["modelValue","label"])])),default:(0,l.k6)((()=>[(0,l.bF)(p.J,(0,i._B)((0,l.Ng)(e.$attrs)),{default:(0,l.k6)((()=>[(0,l.bF)(g.I,null,{default:(0,l.k6)((()=>[(0,l.bF)(b.L,null,{default:(0,l.k6)((()=>[(0,l.bF)(v.B,null,{default:(0,l.k6)((()=>[(0,l.bF)(y.x8,{selected:e.special,"onUpdate:selected":t[1]||(t[1]=t=>e.special=t)},{default:(0,l.k6)((()=>[(0,l.bF)(k.g,{value:"custom"},{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)(" Custom ")]))),_:1}),(0,l.bF)(k.g,{value:"last7d"},{default:(0,l.k6)((()=>t[5]||(t[5]=[(0,l.eW)(" Last 7 days ")]))),_:1}),(0,l.bF)(k.g,{value:"last28d"},{default:(0,l.k6)((()=>t[6]||(t[6]=[(0,l.eW)(" Last 28 days ")]))),_:1}),(0,l.bF)(k.g,{value:"today"},{default:(0,l.k6)((()=>t[7]||(t[7]=[(0,l.eW)(" Today ")]))),_:1}),(0,l.bF)(k.g,{value:"yesterday"},{default:(0,l.k6)((()=>t[8]||(t[8]=[(0,l.eW)(" Yesterday ")]))),_:1}),(0,l.bF)(k.g,{value:"thismonth"},{default:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.eW)(" This month ")]))),_:1}),(0,l.bF)(k.g,{value:"lastmonth"},{default:(0,l.k6)((()=>t[10]||(t[10]=[(0,l.eW)(" Last month ")]))),_:1}),(0,l.bF)(k.g,{value:"thisyear"},{default:(0,l.k6)((()=>t[11]||(t[11]=[(0,l.eW)(" This year ")]))),_:1}),(0,l.bF)(k.g,{value:"lastyear"},{default:(0,l.k6)((()=>t[12]||(t[12]=[(0,l.eW)(" Last year ")]))),_:1})])),_:1},8,["selected"])])),_:1}),(0,l.bF)(f.f,{modelValue:e.value,"onUpdate:modelValue":t[2]||(t[2]=t=>e.value=t),"no-title":"",multiple:"range"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},16)])),_:1},8,["modelValue"])}a(44114);var D=a(49148),V=a.n(D),_={name:"DateRange",props:{modelValue:{type:[String,Array]},label:String},emits:["update:modelValue"],data:()=>({special:["custom"],menu:!1,value:[],specialPressed:!1,ready:!1}),methods:{parseDate:function(e){const t=new Date(e);if(!t)return;const a=t.getFullYear(),l=t.getMonth()+1,i=t.getDate(),o=l.toString().padStart(2,"0"),n=i.toString().padStart(2,"0");return`${a}-${o}-${n}`},createDateRange:async function(){let e,t=this.modelValue;const a=new Date,l=a.getFullYear(),i=a.getMonth();if("string"===typeof t){if("today"===t)e=[a];else if("yesterday"===t)e=[new Date(Date.now()-864e5)];else if("thismonth"===t)e=[new Date(l,i,1),new Date(l,i+1,0)];else if("lastmonth"===t)e=[new Date(l,i-1,1),new Date(l,i,0)];else if("thisyear"===t)e=[new Date(l,0,1),new Date(l,11,31)];else if("lastyear"===t)e=[new Date(l-1,0,1),new Date(l-1,11,31)];else{const l=t.match(/^last([0-9]+)d$/);if(l){const t=parseInt(l[1])-1;e=[new Date(Date.now()-864e5*t),a]}}e?this.special=[t]:e=[t]}else e=t;if(!e?.[0])return!1;let o=new Date(e[0]),n=new Date(e[e.length-1]);n.setHours(o.getHours());let s=[];while(o<=n)console.log(o),s.push(new Date(o)),o.setDate(o.getDate()+1);this.specialPressed=!0,"custom"===this.special[0]&&this.ready||(this.value=s,this.ready=!0),await this.$nextTick(),this.specialPressed=!1},formatDate:function(e){return V()(e).format("DD-MMM-YYYY")}},watch:{special:function(e){"custom"!==e[0]&&this.$emit("update:modelValue",e[0])},value:function(e){let t;this.specialPressed||(this.special=["custom"]),t="custom"!==this.special[0]?this.special[0]:e[0]?[this.parseDate(e[0]),this.parseDate(e[e.length-1])]:null,JSON.stringify(t)!=JSON.stringify(this.modelValue)&&this.$emit("update:modelValue",t)},modelValue:function(){this.createDateRange()}},computed:{dateRangeText(){return this.value?.[0]?this.formatDate(this.value[0])+" - "+this.formatDate(this.value[this.value.length-1]):"-"}},mounted:function(){this.createDateRange()}},C=a(71241);const S=(0,C.A)(_,[["render",w]]);var W=S,X={name:"SearchField",components:{DateRange:W},props:{modelValue:{required:!0},label:String,column:null,type:null,optionConfig:null,func:null},emits:["update:modelValue","updateFunc"],data:()=>({localFunc:null,value:null,options:[],ranges:[]}),methods:{fieldType(e){switch(e){case"dob":case"date":case"timestamp":return"date";case"int":case"decimal":return"number";case"datetime":return"datetime-local"}return["email","password","dob","time"].includes(e)?e:"text"},fieldStep(e){switch(e){case"int":return 1;case"decimal":return"0.01"}return""},updateCombo:async function(e,t){const a=await h.A.get("?cmd=autocomplete&field="+t+"&term="+e);this.options=a.data.options},getOptions:async function(){this.options=await m.A.getOptions(this.column,this.type,this.optionConfig,{})}},watch:{value:function(e){this.$emit("update:modelValue",e)},localFunc:function(e){this.$emit("updateFunc",this.column,e)},field:function(){this.getOptions()}},mounted:function(){this.getOptions(),this.value=this.modelValue,this.localFunc=this.func,this.localFunc||["decimal","int","id","rating"].includes(this.type)&&(this.localFunc="=")}};const $=(0,C.A)(X,[["render",c]]);var U=$}}]);
//# sourceMappingURL=810.147f23a4.js.map