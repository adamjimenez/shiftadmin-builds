"use strict";(self["webpackChunkshiftadmin"]=self["webpackChunkshiftadmin"]||[]).push([[490],{5089:function(e,t,a){a.d(t,{A:function(){return b}});var i=a(56768),l=a(24232),o=a(13892),n=a(41720),s=a(35526),r=a(69915),d=a(57254),c=a(4913),u=a(88249);const h={class:"d-flex w-100 align-center"};function m(e,t,a,m,p,f){return(0,i.uX)(),(0,i.CE)("span",h,[(0,i.bF)(o.D,{variant:"text",title:"Add",icon:"mdi-plus",to:f.base+"section/"+e.internalSection+"/add"+(a.parentsection?"?parentsection="+a.parentsection+"&parentid="+a.parentid:"")},null,8,["to"]),(0,i.bF)(o.D,{variant:"text",title:"Fields",icon:"mdi-view-column",color:"grey-lighten-1",onClick:f.changeFields},null,8,["onClick"]),a.selected.length?((0,i.uX)(),(0,i.Wv)(o.D,{key:0,variant:"text",title:"Bulk Edit",icon:"mdi-pencil",color:"grey-lighten-1",onClick:t[0]||(t[0]=e=>f.doAction("openBulkEdit"))})):(0,i.Q3)("",!0),a.selected.length?((0,i.uX)(),(0,i.Wv)(o.D,{key:1,variant:"text",title:"Delete",icon:"mdi-delete",color:"grey-lighten-1",onClick:t[1]||(t[1]=e=>f.doAction("delete"))})):(0,i.Q3)("",!0),(0,i.bF)(o.D,{variant:"text",title:"Import",icon:"mdi-import",color:"grey-lighten-1",onClick:f.openImport},null,8,["onClick"]),(0,i.bF)(o.D,{variant:"text",title:"Export",icon:"mdi-export",color:"grey-lighten-1",onClick:f.exportItems},null,8,["onClick"]),a.sortable?((0,i.uX)(),(0,i.Wv)(o.D,{key:2,variant:"text",title:"Sort",icon:"mdi-sort",color:"grey-lighten-1",onClick:t[2]||(t[2]=e=>f.doAction("openSortable"))})):(0,i.Q3)("",!0),f.buttons.length?((0,i.uX)(),(0,i.Wv)(u.q,{key:3},{activator:(0,i.k6)((({props:e})=>[(0,i.bF)(o.D,(0,i.v6)({variant:"text"},e,{icon:"mdi-dots-vertical"}),null,16)])),default:(0,i.k6)((()=>[(0,i.bF)(r.x8,null,{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(f.buttons,((e,t)=>((0,i.uX)(),(0,i.Wv)(d.g,{key:t,value:t,onClick:t=>f.customButton(e)},{default:(0,i.k6)((()=>[(0,i.bF)(c.U,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.label),1)])),_:2},1024)])),_:2},1032,["value","onClick"])))),128))])),_:1})])),_:1})):(0,i.Q3)("",!0),(0,i.bF)(n.h),a.mobile?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(s.B,{key:4,class:"text-grey-lighten-1 text-right"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(parseInt((a.data.page-1)*a.data.itemsPerPage+1)?.toLocaleString())+"-"+(0,l.v_)(Math.min(a.data.page*a.data.itemsPerPage,a.data.totalItems)?.toLocaleString())+" of "+(0,l.v_)(a.data.totalItems?.toLocaleString()),1)])),_:1})),(0,i.bF)(o.D,{variant:"text",icon:"mdi-chevron-left",disabled:1===a.data.page,onClick:f.prevPage},null,8,["disabled","onClick"]),(0,i.bF)(o.D,{variant:"text",icon:"mdi-chevron-right",disabled:a.data.page*a.data.itemsPerPage>=a.data.totalItems,onClick:f.nextPage},null,8,["disabled","onClick"])])}a(44114),a(98992),a(3949);var p={props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null,selected:null,data:null,headers:null,mobile:null,sortable:Boolean},data:function(){return{dialog:!1,selectedHeaders:[],internalSection:"",loading:!1,filter:""}},methods:{formatString:function(e){return e=e.replace(/_/g," "),e.charAt(0).toUpperCase()+e.slice(1)},doAction:async function(e){this.$emit("action",e)},exportItems:function(){this.$emit("action","export")},changeFields:function(){this.$emit("changeFields")},customButton:function(e){this.$emit("action",e)},openImport:function(){this.$emit("action","import")},prevPage:function(){this.$emit("action","prevPage")},nextPage:function(){this.$emit("action","nextPage")}},watch:{section:function(e){this.internalSection=e},filter:function(e){this.$emit("action","filter",e)}},computed:{buttons:function(){let e=[];return this.vars?.buttons?.forEach(((t,a)=>{"list"===t.page&&t.section===this.internalSection&&(t.id=a,e.push(t))})),e},base(){let e="/";return this.$route.params.base&&(e+=this.$route.params.base+"/"),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section}},f=a(71241);const g=(0,f.A)(p,[["render",m]]);var b=g},42109:function(e,t,a){a.r(t),a.d(t,{default:function(){return z}});var i=a(56768),l=a(24232),o=a(45130),n=a(31969),s=a(13892),r=a(4189),d=a(30697),c=a(93745),u=a(86852),h=a(771),m=a(47697),p=a(91772),f=a(67020),g=a(62598),b=a(51146);const v=["onClick"],k={key:0},y={key:1},S={key:2},_={key:3},C={key:4};function F(e,t,a,F,x,V){const w=(0,i.g2)("ListButtons"),A=(0,i.g2)("ImportExport"),D=(0,i.g2)("BulkEdit"),E=(0,i.g2)("draggable");return(0,i.uX)(),(0,i.Wv)(g.L,null,{default:(0,i.k6)((()=>[(0,i.bF)(h.u,{modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selected=t),headers:V.activeHeaders,items:e.data.data,"item-value":"id","show-select":"","onClick:row":V.rowClick,loading:e.loading,"items-length":e.totalItems,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[2]||(t[2]=t=>e.itemsPerPage=t),search:e.search,"fixed-header":"","fixed-footer":"",class:"data-table-server",page:e.page,"sort-by":e.sortBy,"onUpdate:sortBy":[t[3]||(t[3]=t=>e.sortBy=t),V.updateSortBy]},{top:(0,i.k6)((()=>[e.error?((0,i.uX)(),(0,i.Wv)(n.l,{key:0,title:e.error,type:"error",style:{"max-height":"60px"}},null,8,["title"])):(0,i.Q3)("",!0),(0,i.bF)(b.i,{color:"secondary",class:"w-100"},{default:(0,i.k6)((()=>[a.hidebuttons?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(w,{key:0,selected:e.selected,section:e.internalSection,onChangeFields:t[0]||(t[0]=t=>e.dialog=!0),onAction:V.actionHandler,vars:a.vars,sortable:V.isSortable,data:e.buttonData,mobile:a.mobile},null,8,["selected","section","onAction","vars","sortable","data","mobile"]))])),_:1})])),item:(0,i.k6)((({item:t,internalItem:n,isSelected:s,toggleSelect:r})=>[(0,i.Lk)("tr",{class:"v-data-table__tr v-data-table__tr--clickable",onClick:e=>V.rowClick(e,t)},[(0,i.Lk)("td",{class:(0,l.C4)(["v-data-table__td v-data-table-column--no-padding v-data-table-column--align-start border-primary",e.active===t.id?"active border-s-lg":""]),style:{width:"48px"}},[(0,i.bF)(u.M,{"model-value":s(n),onClick:(0,o.D$)((a=>{e.active=t.id,r(n,!s(n))}),["stop"]),"hide-details":""},null,8,["model-value","onClick"])],2),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(V.activeHeaders,(o=>((0,i.uX)(),(0,i.CE)("td",{key:o,class:"v-data-table__td v-data-table-column--align-start"},[["upload","file","files","uploads"].includes(V.getFieldType(o.value))?((0,i.uX)(),(0,i.CE)("span",k,[(0,i.bF)(f.y,{src:e.apiRoot+"?cmd=file&f="+(Array.isArray(t[o.value])?t[o.value][0]:t[o.value])+"&w=320&h=240",style:{"max-width":"160px","max-height":"120px"}},null,8,["src"])])):["select_multiple"].includes(V.getFieldType(o.value))?((0,i.uX)(),(0,i.CE)("span",y,(0,l.v_)(Array.isArray(t[o.value])?t[o.value].length+" items":""),1)):["select"].includes(V.getFieldType(o.value))&&"object"===typeof a.vars.options?.[o.value]?((0,i.uX)(),(0,i.CE)("span",S,(0,l.v_)(a.vars.options[o.value][t[o.value]]||t[o.value]),1)):t[o.value]&&["editor"].includes(V.getFieldType(o.value))?((0,i.uX)(),(0,i.CE)("span",_,(0,l.v_)(t[o.value].replace(/(<([^>]+)>)/gi,"")),1)):((0,i.uX)(),(0,i.CE)("span",C,(0,l.v_)(V.formatData(t[o.value],V.getFieldType(o.value))),1))])))),128))],8,v)])),bottom:(0,i.k6)((()=>t[10]||(t[10]=[]))),_:1},8,["modelValue","headers","items","onClick:row","loading","items-length","items-per-page","search","page","sort-by","onUpdate:sortBy"]),(0,i.bF)(A,{ref:"importExport",headers:e.headers,section:e.internalSection,fields:a.searchparams,columns:e.selectedHeaders,onReload:V.reload},null,8,["headers","section","fields","columns","onReload"]),(0,i.bF)(D,{ref:"bulkEdit",section:e.internalSection,fields:e.data?.fields,onAction:V.actionHandler,vars:a.vars,count:e.selected.length,defaultData:e.defaultData},null,8,["section","fields","onAction","vars","count","defaultData"]),(0,i.bF)(p.p,{modelValue:e.dialog,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialog=t),"max-width":"600",scrollable:""},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{title:"Fields"},{default:(0,i.k6)((()=>[(0,i.bF)(m.Py,{modelValue:e.selectedHeaders,"onUpdate:modelValue":t[4]||(t[4]=t=>e.selectedHeaders=t),headers:[{title:"Field",key:"title"}],items:e.headers,"item-value":"key","items-per-page":"-1","show-select":""},{bottom:(0,i.k6)((()=>t[11]||(t[11]=[]))),_:1},8,["modelValue","items"])])),_:1})])),_:1},8,["modelValue"]),(0,i.bF)(p.p,{modelValue:e.sortableDialog,"onUpdate:modelValue":t[9]||(t[9]=t=>e.sortableDialog=t),"max-width":"600",scrollable:""},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{title:"Sort Order",loading:e.sortOrderLoading},{default:(0,i.k6)((()=>[(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(E,{modelValue:e.sortOrder,"onUpdate:modelValue":t[6]||(t[6]=t=>e.sortOrder=t),group:"items",onStart:t[7]||(t[7]=t=>e.drag=!0),onEnd:t[8]||(t[8]=t=>e.drag=!1),"item-key":"id"},{item:(0,i.k6)((({element:e})=>[(0,i.bF)(b.i,{color:"primary",class:"ma-5 pa-5"},{default:(0,i.k6)((()=>[(0,i.eW)((0,l.v_)(e.title),1)])),_:2},1024)])),_:1},8,["modelValue"])])),_:1}),(0,i.bF)(c.S,null,{default:(0,i.k6)((()=>[(0,i.bF)(s.D,{variant:"flat",color:"primary",onClick:V.saveSortOrder},{default:(0,i.k6)((()=>t[12]||(t[12]=[(0,i.eW)("Save")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:1})}a(44114),a(98992),a(54520),a(72577),a(3949),a(81454);var x=a(74300),V=a(27274),w=a(19122),A=a.n(w),D=a(5089),E=a(61527),I=a.n(E),O=a(78351),P=a(20105);const $={key:1};function X(e,t,a,l,o,u){return(0,i.uX)(),(0,i.Wv)(p.p,{modelValue:e.importDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.importDialog=t),"max-width":"600",scrollable:""},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{title:"Import"},{default:(0,i.k6)((()=>[(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[e.error?((0,i.uX)(),(0,i.Wv)(n.l,{key:0,text:e.error,type:"error"},null,8,["text"])):(0,i.Q3)("",!0),(0,i.bF)(O.f,{modelValue:e.file,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.file=t),u.readFile],label:"CSV file"},null,8,["modelValue","onUpdate:modelValue"]),e.importHeaders.length?((0,i.uX)(),(0,i.CE)("div",$,[t[2]||(t[2]=(0,i.Lk)("h4",null,"Match up the fields",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.headers,((t,a)=>((0,i.uX)(),(0,i.CE)("div",{key:a},[(0,i.bF)(P.d4,{items:e.importHeaders,label:t.title,modelValue:e.importCols[t.key],"onUpdate:modelValue":a=>e.importCols[t.key]=a},null,8,["items","label","modelValue","onUpdate:modelValue"])])))),128))])):(0,i.Q3)("",!0)])),_:1}),(0,i.bF)(c.S,null,{default:(0,i.k6)((()=>[(0,i.bF)(s.D,{onClick:u.doImport,variant:"flat",color:"primary",disabled:!e.importHeaders.length},{default:(0,i.k6)((()=>t[3]||(t[3]=[(0,i.eW)("Import")]))),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var B={props:{headers:null,section:null,fields:null,columns:null},data:function(){return{error:"",importDialog:!1,importHeaders:[],importCols:{}}},methods:{openImport:function(){this.importDialog=!0},doImport:async function(){const e=new FormData;for(const[a,i]of Object.entries(this.importCols))e.append("fields["+a+"]",i);e.append("file",this.file[0]),this.error="",this.loading=!0;const t=await x.A.post("?cmd=import&section="+this.internalSection,e,{headers:{"Content-Type":"multipart/form-data"}});this.loading=!1,t.data.error?this.error=t.data?.error:(this.importDialog=!1,this.$emit("reload"))},readFile:function(){const e=new FileReader;e.onload=e=>{const t=e.target.result,a=t.split("\n");let i=[],l=a[0].split(",");for(let n=0;n<l.length;n++){const e=l[n].trim();e.startsWith('"')&&e.endsWith('"')?i.push(e.slice(1,-1)):i.push(e)}let o=[];l=a[1].split(",");for(let n=0;n<l.length;n++){const e=l[n].trim();e.startsWith('"')&&e.endsWith('"')?o.push(e.slice(1,-1)):o.push(e)}this.importHeaders=[],i.forEach(((e,t)=>{this.importHeaders.push({value:t,raw:e,title:e+" - "+o[t]})})),this.importCols={},this.headers.forEach((e=>{let t=this.importHeaders.find((t=>t.raw===e.key));this.importCols[e.key]=t?t.value:""}))},e.readAsText(this.file[0])},exportItems:function(){let e={cmd:"export",section:this.section,fields:this.fields,columns:this.columns};const t=A().stringify(e);window.open(x.A.getApiRoot()+"?"+t)}}},U=a(71241);const W=(0,U.A)(B,[["render",X]]);var H=W,L=a(92239),T=a(40276),j=a(57254),J=a(43948);function Q(e,t,a,l,o,u){return(0,i.uX)(),(0,i.Wv)(p.p,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialog=t),"max-width":"600",scrollable:""},{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{title:"Editing "+a.count+" files"},{default:(0,i.k6)((()=>[(0,i.bF)(d.O,null,{default:(0,i.k6)((()=>[e.error?((0,i.uX)(),(0,i.Wv)(n.l,{key:0,text:e.error,type:"error"},null,8,["text"])):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.fields,(t=>((0,i.uX)(),(0,i.CE)(i.FK,{key:t.type},[["id"].includes(t.type)?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(j.g,{key:0},{prepend:(0,i.k6)((()=>[(0,i.bF)(T.a,{modelValue:e.enabled[t.column],"onUpdate:modelValue":a=>e.enabled[t.column]=a},null,8,["modelValue","onUpdate:modelValue"])])),default:(0,i.k6)((()=>[["checkbox"].includes(t.type)?((0,i.uX)(),(0,i.Wv)(T.a,{key:0,label:u.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,disabled:!e.enabled[t.column]},null,8,["label","modelValue","onUpdate:modelValue","disabled"])):["select"].includes(t.type)?((0,i.uX)(),(0,i.Wv)(P.d4,{key:1,label:u.formatString(t.column),items:e.options[t.column],modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,disabled:!e.enabled[t.column]},null,8,["label","items","modelValue","onUpdate:modelValue","disabled"])):["select_multiple"].includes(t.type)?((0,i.uX)(),(0,i.Wv)(P.d4,{key:2,label:u.formatString(t.column),items:e.options[t.column],modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,multiple:"",chips:"",disabled:!e.enabled[t.column]},null,8,["label","items","modelValue","onUpdate:modelValue","disabled"])):"combo"===t.type?((0,i.uX)(),(0,i.Wv)(L.V,{key:3,label:u.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,items:e.options[t.column],"onUpdate:search":e=>u.updateCombo(e,t.column),disabled:!e.enabled[t.column]},null,8,["label","modelValue","onUpdate:modelValue","items","onUpdate:search","disabled"])):((0,i.uX)(),(0,i.Wv)(J.W,{key:4,label:u.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,disabled:!e.enabled[t.column]},null,8,["label","modelValue","onUpdate:modelValue","disabled"]))])),_:2},1024))],64)))),128))])),_:1}),(0,i.bF)(c.S,null,{default:(0,i.k6)((()=>[(0,i.bF)(s.D,{onClick:u.save,variant:"flat",color:"primary",disabled:!u.hasChanges},{default:(0,i.k6)((()=>t[1]||(t[1]=[(0,i.eW)("Save")]))),_:1},8,["onClick","disabled"])])),_:1})])),_:1},8,["title"])])),_:1},8,["modelValue"])}var N={props:{section:null,fields:null,vars:null,count:null,defaultData:null},data:function(){return{dialog:!1,error:"",params:{},enabled:{},options:{}}},methods:{open:async function(){this.options=await V.A.getAllOptions(this.fields,this.vars.options,{}),console.log(this.defaultData),this.params=this.defaultData,this.dialog=!0},formatString:function(e){return V.A.formatString(e)},save:function(){this.$emit("action","bulkedit",{data:this.params}),this.dialog=!1},updateCombo:async function(e,t){const a=await x.A.get("?cmd=autocomplete&field="+t+"&term="+e);this.options[t]=a.data}},computed:{hasChanges:function(){return Object.values(this.enabled).filter((e=>!0===e)).length>0}}};const K=(0,U.A)(N,[["render",Q]]);var R=K,M={components:{ListButtons:D.A,draggable:I(),ImportExport:H,BulkEdit:R},props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null,mobile:null},data:function(){return{dialog:!1,selectedHeaders:[],headers:[],selected:[],data:{},internalSection:"",loading:!1,sortableDialog:!1,totalItems:0,itemsPerPage:20,page:0,search:"",drag:!1,sortOrder:[],sortOrderLoading:!1,file:[],filter:"",buttonData:{},defaultData:{},sortBy:[],error:"",active:0}},methods:{formatString:function(e){return V.A.formatString(e)},loadItems:async function(){this.page||(localStorage["page_"+this.internalSection]>0?this.page=parseInt(localStorage["page_"+this.internalSection]):this.page=1),!this.active&&localStorage["active_"+this.internalSection]>0&&(this.active=localStorage["active_"+this.internalSection]);let e=this.searchparams;this.filter&&(e.s=this.filter);let t={cmd:"get",section:this.internalSection,fields:e,page:this.page,itemsPerPage:this.itemsPerPage,sortBy:this.sortBy,columns:this.selectedHeaders};this.parentsection&&(t.parentsection=this.parentsection),this.parentid&&(t.parentid=this.parentid);const a=A().stringify(t);this.loading=!0,this.error="";let i={};try{i=await x.A.get("?"+a.toString(),t)}catch(r){console.log(r)}if(i.data.error&&(this.error=i.data.error),this.loading=!1,!i.data?.fields)return!1;i.data.data||(i.data.data=[],i.data.total=0),i.data.data.forEach((e=>{for(const[,t]of Object.entries(i.data.fields))e[t.column+"_label"]&&(e[t.column]=e[t.column+"_label"])})),this.data=i.data,this.totalItems=this.data.total,this.data.data.find((e=>e.id===this.active))||(this.active=this.data.data[0]?.id),this.buttonData={page:this.page,itemsPerPage:this.itemsPerPage,totalItems:this.totalItems};let l=[],o=Object.values(i.data.fields);if(o.length&&!o.find((e=>"id"===e.column))){let e=V.A.base();return this.$router.push(e+"section/"+this.internalSection+"/1/"),!1}for(const[,d]of Object.entries(this.data.fields))l.push({title:this.formatString(d.column),key:d.column});this.headers=l,await this.$nextTick();let n=o.map((e=>e.column));this.selectedHeaders.length||(this.selectedHeaders=n),this.$emit("changeHeaders",o),this.sortOrder=[],this.isSortable&&(this.data.data.forEach((e=>{let t=Object.keys(e)[0];this.sortOrder.push({title:t+": "+e[t],id:e.id,position:e.position})})),this.sortOrder.sort(((e,t)=>e.position-t.position)));let s=this.vars?.branding?.title?this.vars.branding.title:"ADMIN";document.title=s+" | "+this.formatString(this.internalSection),await this.$nextTick(),this.$emit("updateCount",this.data),this.$emit("loaded")},rowClick:function(e,t){this.active=t.id;let a="/";this.$route.params.base&&(a+=this.$route.params.base+"/");let i=a+"section/"+this.internalSection+"/"+t.id+"/";this.parentsection&&(i+="?parentsection="+this.parentsection+"&parentid="+this.parentid),this.$router.push(i)},actionHandler:async function(e){let t={};if("export"===e)return["Pro","Business","Trial"].includes(V.A.getEdition())?void this.$refs["importExport"].exportItems():void this.$router.push(V.A.base()+"upgrade");if("import"===e)return["Pro","Business","Trial"].includes(V.A.getEdition())?void this.$refs["importExport"].openImport():void this.$router.push(V.A.base()+"upgrade");if("openBulkEdit"===e){this.defaultData={};let e=0;return this.selected.forEach((t=>{let a=this.data.data.find((e=>t==e.id));for(const[i,l]of Object.entries(a))0===e?this.defaultData[i]=l:this.defaultData[i]!==l&&(this.defaultData[i]=null);e++})),void this.$refs["bulkEdit"].open()}if("openSortable"===e)return void(this.sortableDialog=!0);if("filter"===e)return this.filter=arguments[1],void this.reload();if("prevPage"===e){if(1===this.page)return;return this.page--,void this.reload()}if("nextPage"===e){if(this.page*this.itemsPerPage>=this.totalItems)return;return this.page++,void this.reload()}if("string"===typeof e){if("delete"===e&&!this.data?.fields.deleted&&!confirm("Are you sure you want to delete these items?"))return;t={cmd:e,section:this.internalSection,ids:this.selected},"object"===typeof arguments[1]&&(t={...t,...arguments[1]}),this.loading=!0;const a=await x.A.post("?cmd="+e+"&section="+this.internalSection,t);return this.loading=!1,void(a.data.error?this.error=a.data.error:this.reload())}if(!["Pro","Business","Trial"].includes(V.A.getEdition()))return void this.$router.push(V.A.base()+"upgrade");t={cmd:"button",button:e.id,section:this.internalSection,ids:this.selected},this.loading=!0;const a=await x.A.post("?cmd=button&section="+this.internalSection,t);this.loading=!1,a.data.error&&(this.error=a.data.error),a.data.result?.redirect?e.target?window.open(a.data.result.redirect):location.href=a.data.result.redirect:this.reload()},saveSortOrder:async function(){let e={cmd:"reorder",section:this.section,items:this.sortOrder};this.sortOrderLoading=!0,await x.A.post("?cmd=reorder&section="+this.internalSection,e),this.sortOrderLoading=!1,this.sortableDialog=!1,this.reload()},reload:function(){this.loadItems()},updateSortBy:function(e){localStorage["sortBy_"+this.internalSection]=JSON.stringify(e),this.reload()},getFieldType:function(e){return this.data?.fields[e.replaceAll("_"," ")]?.type},formatData:function(e,t){return V.A.formatData(e,t)},onKeydown:async function(e){let t,a;switch(e.key){case"ArrowDown":e.preventDefault(),t=this.data.data.findIndex((e=>e.id===this.active)),t+1<this.data.data.length&&(this.active=this.data.data[t+1].id),await this.$nextTick(),a=document.getElementsByClassName("active")[0],a.scrollIntoView(!1);break;case"ArrowUp":e.preventDefault(),t=this.data.data.findIndex((e=>e.id===this.active)),t>0&&(this.active=this.data.data[t-1].id),await this.$nextTick(),a=document.getElementsByClassName("active")[0],a.scrollIntoView(!1);break;case"Enter":break}}},watch:{internalSection:function(e){this.selectedHeaders=localStorage["fields_"+e]?JSON.parse(localStorage["fields_"+e]):[],this.sortBy=localStorage["sortBy_"+e]?JSON.parse(localStorage["sortBy_"+e]):[],this.page=0,this.reload()},$route(e){this.internalSection!==e.params.section?this.internalSection=e.params.section:this.reload()},section:function(e){this.internalSection=e,e&&this.reload()},selectedHeaders:function(e,t){if(JSON.stringify(e)!==JSON.stringify(t)&&(localStorage["fields_"+this.internalSection]=JSON.stringify(Object.values(e))),this.data.fields){let t=[];for(const[,a]of Object.entries(this.data.fields))e.includes(a.column)&&t.push(a);this.$emit("changeFields",t)}},headers:function(e){let t=localStorage["fields_"+this.internalSection],a=t?JSON.parse(t):e.map((e=>e.key)),i=e.map((e=>e.key));a=a.filter((e=>i.includes(e))),this.selectedHeaders=a},selected:function(e){this.$emit("changeSelected",e)},page:function(e){localStorage["page_"+this.internalSection]=e},active:function(e){localStorage["active_"+this.internalSection]=e}},computed:{activeHeaders:function(){let e=[];return this.data.fields&&Object.values(this.data.fields).forEach((t=>{this.selectedHeaders.includes(t.column)&&e.push({title:this.formatString(t.column),value:t.column,sortable:!0})})),e},isSortable:function(){let e=!1;return this.data.fields&&Object.values(this.data.fields).forEach((t=>{"position"===t.type&&(e=!0)})),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section,this.apiRoot=x.A.getApiRoot()},mounted(){document.addEventListener("keydown",this.onKeydown)},unmounted(){document.removeEventListener("keydown",this.onKeydown)}};const q=(0,U.A)(M,[["render",F]]);var z=q}}]);
//# sourceMappingURL=490.b87e395a.js.map