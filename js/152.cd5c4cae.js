"use strict";(self["webpackChunkshiftadmin"]=self["webpackChunkshiftadmin"]||[]).push([[152,176],{38033:function(t,e,i){i.r(e),i.d(e,{default:function(){return z}});var a=i(56768),l=i(24232),o=i(13892),n=i(4189),s=i(91606),u=i(30697),c=i(16009),r=i(93745),d=i(68272),f=i(74025),m=i(91772),h=i(79669),g=i(69915),p=i(57254),v=i(4913),k=i(97505),b=i(88249),y=i(55263),_=i(20105),C=i(51146),X=i(10381),D=i(76686);const w={key:1,class:"w-100"},F={class:"pa-5 d-flex flex-column",style:{height:"1px",overflow:"auto","flex-grow":"1"}},W={key:0},A=["href"],x=["href"],E=["href"],L=["href"],P={key:5,class:"mx-5"},V={key:6},S=["href"],$=["src"],I={key:8},U=["src"],O=["innerHTML"],R={key:11},B=["innerHTML"],H={key:0};function K(t,e,i,K,Q,T){const M=(0,a.g2)("ListButtons"),j=(0,a.g2)("list-page");return(0,a.uX)(),(0,a.Wv)(n.J,{class:"d-flex flex-column"},{default:(0,a.k6)((()=>[(0,a.bF)(C.i,{color:"secondary",class:"w-100 d-flex"},{default:(0,a.k6)((()=>[t.back?((0,a.uX)(),(0,a.Wv)(o.D,{key:0,title:"Back",icon:"mdi-arrow-left",onClick:T.goBack,color:"grey-lighten-1",variant:"text"},null,8,["onClick"])):(0,a.Q3)("",!0),"summary"===t.tab?((0,a.uX)(),(0,a.CE)("span",w,[(0,a.bF)(o.D,{title:"Edit",icon:"mdi-pencil",color:"grey-lighten-1",variant:"text",onClick:T.edit},null,8,["onClick"]),t.data["deleted"]>0?((0,a.uX)(),(0,a.Wv)(o.D,{key:0,title:"Restore",icon:"mdi-delete-restore",color:"success",onClick:T.restoreItem,variant:"text"},null,8,["onClick"])):((0,a.uX)(),(0,a.Wv)(o.D,{key:1,title:"Delete",icon:"mdi-delete",color:"grey-lighten-1",onClick:T.deleteItem,variant:"text"},null,8,["onClick"])),(0,a.bF)(o.D,{title:"Logs",icon:"mdi-text",color:"grey-lighten-1",onClick:T.openLogs,variant:"text"},null,8,["onClick"]),t.data.admin>1?((0,a.uX)(),(0,a.Wv)(o.D,{key:2,title:"Privileges",icon:"mdi-account-key",color:"grey-lighten-1",onClick:T.openPrivileges,variant:"text"},null,8,["onClick"])):(0,a.Q3)("",!0),T.buttons.length?((0,a.uX)(),(0,a.Wv)(b.q,{key:3},{activator:(0,a.k6)((({props:t})=>[(0,a.bF)(o.D,(0,a.v6)(t,{icon:"mdi-dots-vertical",color:"grey-lighten-1",variant:"text"}),null,16)])),default:(0,a.k6)((()=>[(0,a.bF)(g.x8,null,{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(T.buttons,((t,e)=>((0,a.uX)(),(0,a.Wv)(p.g,{key:e,value:e,onClick:e=>T.customButton(t),disabled:T.checkDisabled(t)},{default:(0,a.k6)((()=>[(0,a.bF)(v.U,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(t.label),1)])),_:2},1024)])),_:2},1032,["value","onClick","disabled"])))),128))])),_:1})])),_:1})):(0,a.Q3)("",!0)])):((0,a.uX)(),(0,a.Wv)(M,{key:2,selected:t.selected,section:t.tab,onChangeFields:T.changeFields,parentsection:t.section,parentid:t.id,sortable:T.isSortable,onAction:T.actionHandler,data:t.buttonData},null,8,["selected","section","onChangeFields","parentsection","parentid","sortable","onAction","data"]))])),_:1}),(0,a.Lk)("div",F,[(0,a.bF)(X.h,{modelValue:t.tab,"onUpdate:modelValue":e[0]||(e[0]=e=>t.tab=e),style:{"min-height":"50px"}},{default:(0,a.k6)((()=>[(0,a.bF)(D.U,{value:"summary"},{default:(0,a.k6)((()=>[(0,a.eW)("Summary")])),_:1}),i.vars.subsections&&i.vars.subsections[t.section]?.length?((0,a.uX)(!0),(0,a.CE)(a.FK,{key:0},(0,a.pI)(i.vars?.subsections[t.section],(t=>((0,a.uX)(),(0,a.Wv)(D.U,{key:t.subsection,value:t.subsection},{default:(0,a.k6)((()=>[t.icon?((0,a.uX)(),(0,a.Wv)(h.w,{key:0,icon:t.icon,start:""},null,8,["icon"])):(0,a.Q3)("",!0),(0,a.eW)(" "+(0,l.v_)(t.title),1)])),_:2},1032,["value"])))),128)):(0,a.Q3)("",!0)])),_:1},8,["modelValue"]),"summary"===t.tab?((0,a.uX)(),(0,a.Wv)(n.J,{key:0,"min-width":"600",style:{overflow:"auto"}},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.fields,((e,i,n)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:n},[t.data[e.column]&&!["password"].includes(e.type)&&(!["file","select","select_parent","combo"].includes(e.type)||t.data[e.column]>0)?((0,a.uX)(),(0,a.CE)("div",W,[(0,a.bF)(s.r,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(T.formatString(i)),1)])),_:2},1024),(0,a.bF)(u.O,{title:i},{default:(0,a.k6)((()=>["email"===e.type?((0,a.uX)(),(0,a.CE)("a",{key:0,href:"mailto:"+t.data[e.column]},(0,l.v_)(t.data[e.column]),9,A)):"tel"===e.type?((0,a.uX)(),(0,a.CE)("a",{key:1,href:"tel:"+t.data[e.column]},(0,l.v_)(t.data[e.column]),9,x)):"url"===e.type?((0,a.uX)(),(0,a.CE)("a",{key:2,href:t.data[e.column],target:"_blank"},(0,l.v_)(t.data[e.column]),9,E)):"coords"===e.type?((0,a.uX)(),(0,a.CE)("a",{key:3,href:"https://www.google.com/maps/search/?api=1&query="+t.data[e.column],target:"_blank"},(0,l.v_)(t.data[e.column]),9,L)):["select","select_parent","combo"].includes(e.type)?((0,a.uX)(),(0,a.Wv)(o.D,{key:4,to:T.getSelectLink(i,t.data[e.column]),variant:"text"},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(t.data[e.column+"_label"]?t.data[e.column+"_label"]:T.getOption(t.options[e.column],t.data[e.column]).title),1)])),_:2},1032,["to"])):"select_multiple"===e.type?((0,a.uX)(),(0,a.CE)("div",P,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.data[e.column],((n,s,u)=>((0,a.uX)(),(0,a.Wv)(o.D,{key:u,to:T.getSelectLink(i,n),variant:"text"},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(T.getOption(t.options[e.column],n)?.title),1)])),_:2},1032,["to"])))),128))])):"rating"===e.type?((0,a.uX)(),(0,a.CE)("span",V,[(0,a.bF)(y.e,{modelValue:t.data[e.column],"onUpdate:modelValue":i=>t.data[e.column]=i,length:5,size:32,readonly:""},null,8,["modelValue","onUpdate:modelValue"])])):["file","upload"].includes(e.type)?((0,a.uX)(),(0,a.CE)("a",{key:7,href:t.apiRoot+"?cmd=file&f="+t.data[e.column],target:"_blank"},[(0,a.Lk)("img",{src:t.apiRoot+"?cmd=file&f="+t.data[e.column]+"&w=320&h=240"},null,8,$),(0,a.Lk)("div",null,(0,l.v_)(t.data[e.column]),1)],8,S)):["files","uploads"].includes(e.type)?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.bF)(d.n,null,{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.data[e.column],(e=>((0,a.uX)(),(0,a.Wv)(f.q,{key:e,src:t.apiRoot+"?cmd=file&f="+e},null,8,["src"])))),128))])),_:2},1024)])):"upload"===e.type?((0,a.uX)(),(0,a.CE)("img",{key:9,src:t.apiRoot+"?cmd=upload&f="+t.data[e.column]+"&w=320&h=240"},null,8,U)):"editor"===e.type?((0,a.uX)(),(0,a.CE)("div",{key:10,innerHTML:t.data[e.column]},null,8,O)):((0,a.uX)(),(0,a.CE)("span",R,[(0,a.eW)((0,l.v_)(T.formatData(t.data[e.column],e.type))+" ",1),"color"===e.type?((0,a.uX)(),(0,a.CE)("span",{key:0,style:(0,l.Tr)("background-color: "+t.data[e.column]),class:"ml-3 px-2"},null,4)):(0,a.Q3)("",!0)]))])),_:2},1032,["title"])])):(0,a.Q3)("",!0)],64)))),128))])),_:1})):((0,a.uX)(),(0,a.Wv)(j,{key:1,section:t.tab,parentsection:t.section,parentid:t.id,hidebuttons:"",ref:"listPage",vars:i.vars,onLoaded:T.loaded},null,8,["section","parentsection","parentid","vars","onLoaded"]))]),(0,a.bF)(m.p,{modelValue:t.logsDialog,"onUpdate:modelValue":e[2]||(e[2]=e=>t.logsDialog=e),"max-width":"600",scrollable:""},{default:(0,a.k6)((()=>[(0,a.bF)(n.J,{title:"Logs",loading:t.loadingLogs},{default:(0,a.k6)((()=>[t.logs.length?((0,a.uX)(),(0,a.Wv)(g.x8,{key:0},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.logs,(i=>((0,a.uX)(),(0,a.Wv)(p.g,{key:i.id,class:"unclamp mb-3"},{default:(0,a.k6)((()=>[(0,a.bF)(v.U,null,{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(T.formatString(i.task))+" on "+(0,l.v_)(T.formatDateTime(i.date)),1)])),_:2},1024),(0,a.bF)(k.w,null,{default:(0,a.k6)((()=>[(0,a.Lk)("div",{innerHTML:i.details,style:{"white-space":"pre"}},null,8,B)])),_:2},1024),i.user>0?((0,a.uX)(),(0,a.CE)("div",H,[(0,a.bF)(o.D,{variant:"text",to:this.base+"section/users/"+i.user,onClick:e[1]||(e[1]=e=>t.logsDialog=!1)},{default:(0,a.k6)((()=>[(0,a.eW)((0,l.v_)(i.name.trim()?i.name:i.user),1)])),_:2},1032,["to"])])):(0,a.Q3)("",!0)])),_:2},1024)))),128))])),_:1})):((0,a.uX)(),(0,a.Wv)(u.O,{key:1},{default:(0,a.k6)((()=>[(0,a.eW)(" No logs found. ")])),_:1}))])),_:1},8,["loading"])])),_:1},8,["modelValue"]),(0,a.bF)(m.p,{modelValue:t.privilegesDialog,"onUpdate:modelValue":e[3]||(e[3]=e=>t.privilegesDialog=e),"max-width":"600",scrollable:""},{default:(0,a.k6)((()=>[(0,a.bF)(n.J,{title:"Privileges",loading:t.loadingPrivileges},{default:(0,a.k6)((()=>[(0,a.bF)(g.x8,null,{default:(0,a.k6)((()=>[(0,a.bF)(c.m,null,{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.sections,(e=>((0,a.uX)(),(0,a.Wv)(_.d4,{key:e,label:e,modelValue:t.privileges[e].access,"onUpdate:modelValue":i=>t.privileges[e].access=i,items:t.accessOptions},null,8,["label","modelValue","onUpdate:modelValue","items"])))),128))])),_:1})])),_:1}),(0,a.bF)(r.S,null,{default:(0,a.k6)((()=>[(0,a.bF)(o.D,{onClick:T.savePrivileges,color:"primary",variant:"flat"},{default:(0,a.k6)((()=>[(0,a.eW)("Save")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:1})}i(44114),i(14603),i(47566),i(98721);var Q=i(74300),T=i(27274),M=i(67406),j=i(5089),J={components:{ListPage:M["default"],ListButtons:j.A},props:{vars:null},data:function(){return{data:{},fields:[],section:"",id:0,tab:"summary",logsDialog:!1,loadingLogs:!1,logs:[],privilegesDialog:!1,loadingPrivileges:!1,privileges:{},sections:[],selected:[],headers:[],activeHeaders:[],accessOptions:[{value:0,title:"None"},{value:1,title:"Read"},{value:2,title:"Write"},{value:3,title:"Full"}],apiRoot:"",options:[],back:"../",buttonData:{}}},methods:{fetchData:async function(){let t={cmd:"get",section:this.section,id:this.id};const e=await Q.A.post("?section="+this.section,t);if(!e)return!1;let i=e.data.fields;if(this.$emit("changeFields",Object.values(i)),e.data.data){let t=e.data.data;this.options=await T.A.getAllOptions(i,this.vars.options,this.section,t);for(const[,e]of Object.entries(i))"password"===e.type?t[e.column]="":"checkbox"===e.type?t[e.column]=t[e.column]=t[e.column]>0:"select_multiple"!==e.type||Array.isArray(t[e.column])||(t[e.column]=[]);this.data=t}else this.data={};this.fields=e.data.fields;let a=this.vars?.branding?.title?this.vars.branding.title:"ADMIN";document.title=a+" | "+this.section+" | "+this.id;const l=new URLSearchParams(window.location.search),o=l.get("parentsection");if(o){const t=l.get("parentid");this.back="../../"+o+"/"+t+"/"}else i.id?this.back="../":this.back=""},openLogs:async function(){this.logsDialog=!0,this.loadingLogs=!0;const t=await Q.A.get("?cmd=logs&section="+this.section+"&id="+this.id);if(this.loadingLogs=!1,!t)return!1;this.logs=t.data.data},openPrivileges:async function(){if(!["Business"].includes(T.A.getEdition()))return void this.$router.push(T.A.base()+"upgrade");this.privilegesDialog=!0,this.loadingPrivileges=!0;const t=await Q.A.get("?cmd=privileges&user_id="+this.id);if(this.loadingPrivileges=!1,!t)return!1;this.privileges=t.data.privileges,this.sections=t.data.sections},savePrivileges:async function(){this.loadingPrivileges=!0,await Q.A.post("?cmd=privileges&user_id="+this.id,{privileges:this.privileges}),this.privilegesDialog=!1},restoreItem:async function(){if(!confirm("Are you sure you want to restore?"))return;let t={section:this.section,id:this.id};await Q.A.post("?cmd=restore&section="+this.section,t),this.fetchData()},deleteItem:async function(){if(!confirm("Are you sure to delete?"))return;let t={section:this.section,ids:[this.id]};await Q.A.post("?cmd=delete&section="+this.section,t),this.$router.push(this.back)},changeFields:function(){this.$refs["listPage"].dialog=!0},actionHandler:function(){this.$refs["listPage"].actionHandler(...arguments)},getSelectLink:function(t,e){let i=this.vars.options[t.replaceAll("_"," ")];if("string"===typeof i)return"../../"+i.replaceAll("_"," ")+"/"+e+"/"},customButton:async function(t){if(t.confirm){let e=confirm(t.confirm);if(!e)return!1}let e={cmd:"button",button:t.id,section:this.section,ids:[this.id]};this.loading=!0;const i=await Q.A.post("?cmd=button&section="+this.section,e);this.loading=!1,i.data.error&&alert(i.data.error),i.data.result?.redirect?i.data.result?.target?window.open(i.data.result.redirect):location.href=i.data.result.redirect:await this.fetchData()},getOption:function(t,e){return t.find((t=>t.value===e))},formatData:function(t,e){return T.A.formatData(t,e)},formatDateTime:function(t){return T.A.formatDateTime(t)},formatString:function(t){return T.A.formatString(t)},loaded:function(){let t=this.$refs["listPage"]?.buttonData;this.buttonData=t||{}},edit:function(){this.$router.push("edit"+location.search)},checkDisabled:function(t){if("object"===typeof t.enabled){let e=!0;for(const[i,a]of Object.entries(t.enabled))this.data[i]!=a&&(e=!1);if(!1===e)return!0}return!1},goBack:function(){this.$router.push(this.back)}},computed:{base:function(){return T.A.base()},buttons:function(){let t=[];return this.vars?.buttons?.forEach(((e,i)=>{"view"===e.page&&e.section===this.section&&(e.id=i,t.push(e))})),t},isSortable:function(){return this.$refs["listPage"]?.isSortable}},watch:{$route(){this.section=this.$route.params.section,this.id=this.$route.params.id,this.tab="summary",this.fetchData()},vars:function(){this.fetchData()}},async mounted(){this.section=this.$route.params.section,this.id=this.$route.params.id,this.apiRoot=Q.A.getApiRoot(),this.vars.sections&&this.fetchData()}},q=i(71241);const N=(0,q.A)(J,[["render",K],["__scopeId","data-v-6ac7f090"]]);var z=N}}]);
//# sourceMappingURL=152.cd5c4cae.js.map