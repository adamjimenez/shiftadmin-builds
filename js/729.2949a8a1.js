"use strict";(self["webpackChunkshiftadmin"]=self["webpackChunkshiftadmin"]||[]).push([[729],{8346:function(e,t,a){a.d(t,{Z:function(){return U}});var l=a(3396),o=a(7139),i=a(870),n=a(9234),s=(a(560),a(8099),a(9166)),r=a(8157),d=a(1138),u=a(3766),c=a(1107);const m=(()=>r.AV.reduce(((e,t)=>(e[t]={type:[Boolean,String,Number],default:!1},e)),{}))(),p=(()=>r.AV.reduce(((e,t)=>{const a="offset"+(0,o.kC)(t);return e[a]={type:[String,Number],default:null},e}),{}))(),h=(()=>r.AV.reduce(((e,t)=>{const a="order"+(0,o.kC)(t);return e[a]={type:[String,Number],default:null},e}),{}))(),g={col:Object.keys(m),offset:Object.keys(p),order:Object.keys(h)};function f(e,t,a){let l=e;if(null!=a&&!1!==a){if(t){const a=t.replace(e,"");l+=`-${a}`}return"col"===e&&(l="v-"+l),"col"!==e||""!==a&&!0!==a?(l+=`-${a}`,l.toLowerCase()):l.toLowerCase()}}const b=["auto","start","end","center","baseline","stretch"],v=(0,u.U)({cols:{type:[Boolean,String,Number],default:!1},...m,offset:{type:[String,Number],default:null},...p,order:{type:[String,Number],default:null},...h,alignSelf:{type:String,default:null,validator:e=>b.includes(e)},...(0,s.l)(),...(0,d.Q)()},"VCol"),y=(0,c.ev)()({name:"VCol",props:v(),setup(e,t){let{slots:a}=t;const o=(0,l.Fl)((()=>{const t=[];let a;for(a in g)g[a].forEach((l=>{const o=e[l],i=f(a,l,o);i&&t.push(i)}));const l=t.some((e=>e.startsWith("v-col-")));return t.push({"v-col":!l||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),t}));return()=>(0,l.h)(e.tag,{class:[o.value,e.class],style:e.style},a.default?.())}});var w=a(6052),S=a(9457),k=a(2127),V=a(4193);const x={class:"d-flex w-100 align-center"};function C(e,t,a,s,r,d){return(0,l.wg)(),(0,l.iD)("span",x,[(0,l.Wm)(i.T,{variant:"text",title:"Add",icon:"mdi-plus",to:d.base+"section/"+e.internalSection+"/add"+(a.parentsection?"?parentsection="+a.parentsection+"&parentid="+a.parentid:"")},null,8,["to"]),(0,l.Wm)(i.T,{variant:"text",title:"Fields",icon:"mdi-view-column",color:"grey-lighten-1",onClick:d.changeFields},null,8,["onClick"]),a.selected.length?((0,l.wg)(),(0,l.j4)(i.T,{key:0,variant:"text",title:"Bulk Edit",icon:"mdi-pencil",color:"grey-lighten-1",onClick:t[0]||(t[0]=e=>d.doAction("openBulkEdit"))})):(0,l.kq)("",!0),a.selected.length?((0,l.wg)(),(0,l.j4)(i.T,{key:1,variant:"text",title:"Delete",icon:"mdi-delete",color:"grey-lighten-1",onClick:t[1]||(t[1]=e=>d.doAction("delete"))})):(0,l.kq)("",!0),(0,l.Wm)(i.T,{variant:"text",title:"Import",icon:"mdi-import",color:"grey-lighten-1",onClick:d.openImport},null,8,["onClick"]),(0,l.Wm)(i.T,{variant:"text",title:"Export",icon:"mdi-export",color:"grey-lighten-1",onClick:d.exportItems},null,8,["onClick"]),a.sortable?((0,l.wg)(),(0,l.j4)(i.T,{key:2,variant:"text",title:"Sort",icon:"mdi-sort",color:"grey-lighten-1",onClick:t[2]||(t[2]=e=>d.doAction("openSortable"))})):(0,l.kq)("",!0),d.buttons.length?((0,l.wg)(),(0,l.j4)(V.T,{key:3},{activator:(0,l.w5)((({props:e})=>[(0,l.Wm)(i.T,(0,l.dG)({variant:"text"},e,{icon:"mdi-dots-vertical"}),null,16)])),default:(0,l.w5)((()=>[(0,l.Wm)(w.i,null,{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(d.buttons,((e,t)=>((0,l.wg)(),(0,l.j4)(S.l,{key:t,value:t,onClick:t=>d.customButton(e)},{default:(0,l.w5)((()=>[(0,l.Wm)(k.V,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.label),1)])),_:2},1024)])),_:2},1032,["value","onClick"])))),128))])),_:1})])),_:1})):(0,l.kq)("",!0),(0,l.Wm)(n.C),(0,l.Wm)(y,{class:"text-grey-lighten-1 text-right"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)((a.data.page-1)*a.data.itemsPerPage+1)+"-"+(0,o.zw)(Math.min(a.data.page*a.data.itemsPerPage,a.data.totalItems))+" of "+(0,o.zw)(a.data.totalItems),1)])),_:1}),(0,l.Wm)(i.T,{variant:"text",icon:"mdi-chevron-left",disabled:1===a.data.page,onClick:d.prevPage},null,8,["disabled","onClick"]),(0,l.Wm)(i.T,{variant:"text",icon:"mdi-chevron-right",disabled:a.data.page*a.data.itemsPerPage>=a.data.totalItems,onClick:d.nextPage},null,8,["disabled","onClick"])])}var P={props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null,selected:null,data:null,headers:null,sortable:Boolean},data:function(){return{dialog:!1,selectedHeaders:[],internalSection:"",loading:!1,filter:""}},methods:{formatString:function(e){return e=e.replace(/_/g," "),e.charAt(0).toUpperCase()+e.slice(1)},doAction:async function(e){this.$emit("action",e)},exportItems:function(){this.$emit("action","export")},changeFields:function(){this.$emit("changeFields")},customButton:function(e){this.$emit("action",e)},openImport:function(){this.$emit("action","import")},prevPage:function(){this.$emit("action","prevPage")},nextPage:function(){this.$emit("action","nextPage")}},watch:{section:function(e){this.internalSection=e},filter:function(e){this.$emit("action","filter",e)}},computed:{buttons:function(){let e=[];return this.vars?.buttons?.forEach(((t,a)=>{"list"===t.page&&t.section===this.internalSection&&(t.id=a,e.push(t))})),e},base(){let e="/";return this.$route.params.base&&(e+=this.$route.params.base+"/"),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section}},W=a(89);const _=(0,W.Z)(P,[["render",C]]);var U=_},4729:function(e,t,a){a.r(t),a.d(t,{default:function(){return de}});var l=a(3396),o=a(7139),i=a(870),n=a(1489),s=a(1888),r=a(1334),d=a(6658),u=a(2934),c=a(2804),m=a(461),p=a(1231),h=a(7471),g=a(6969),f=a(8829),b=a(3890),v=a(7609),y=a(9207),w=a(2651),S=a(2864),k=a(6107),V=a(4870),x=a(3766),C=a(1107),P=a(9888);const W=(0,x.U)({itemsLength:{type:[Number,String],required:!0},...(0,y.Gj)(),...(0,d.Sz)(),...(0,u.p)()},"VDataTableServer"),_=(0,C.ev)()({name:"VDataTableServer",props:W(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,t){let{attrs:a,slots:o}=t;const{groupBy:i}=(0,g.my)(e),{sortBy:n,multiSort:s,mustSort:r}=(0,S.lx)(e),{page:d,itemsPerPage:x}=(0,y.FV)(e),C=(0,l.Fl)((()=>parseInt(e.itemsLength,10))),{columns:W,headers:_}=(0,f.IT)(e,{groupBy:i,showSelect:(0,V.Vh)(e,"showSelect"),showExpand:(0,V.Vh)(e,"showExpand")}),{items:U}=(0,b.hh)(e,W),{toggleSort:I}=(0,S.NV)({sortBy:n,multiSort:s,mustSort:r,page:d}),{opened:B,isGroupOpen:O,toggleGroup:D,extractRows:H}=(0,g.P_)({groupBy:i,sortBy:n}),{pageCount:j,setItemsPerPage:$}=(0,y.ku)({page:d,itemsPerPage:x,itemsLength:C}),{flatItems:E}=(0,g.T5)(U,i,B),{isSelected:T,select:Z,selectAll:L,toggleSelect:A,someSelected:F,allSelected:N}=(0,w.mH)(e,{allItems:U,currentPage:U}),{isExpanded:q,toggleExpand:G}=(0,h.BM)(e),J=(0,l.Fl)((()=>H(U.value)));(0,v.D)({page:d,itemsPerPage:x,sortBy:n,groupBy:i,search:(0,V.Vh)(e,"search")}),(0,l.JJ)("v-data-table",{toggleSort:I,sortBy:n}),(0,k.AF)({VDataTableRows:{hideNoData:(0,V.Vh)(e,"hideNoData"),noDataText:(0,V.Vh)(e,"noDataText"),loading:(0,V.Vh)(e,"loading"),loadingText:(0,V.Vh)(e,"loadingText")}});const R=(0,l.Fl)((()=>({page:d.value,itemsPerPage:x.value,sortBy:n.value,pageCount:j.value,toggleSort:I,setItemsPerPage:$,someSelected:F.value,allSelected:N.value,isSelected:T,select:Z,selectAll:L,toggleSelect:A,isExpanded:q,toggleExpand:G,isGroupOpen:O,toggleGroup:D,items:J.value.map((e=>e.raw)),internalItems:J.value,groupedItems:E.value,columns:W.value,headers:_.value})));(0,P.L)((()=>{const t=u.i.filterProps(e),i=c.I.filterProps(e),n=m.f.filterProps(e),s=p.Y.filterProps(e);return(0,l.Wm)(p.Y,(0,l.dG)({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},s),{top:()=>o.top?.(R.value),default:()=>o.default?o.default(R.value):(0,l.Wm)(l.HY,null,[o.colgroup?.(R.value),(0,l.Wm)("thead",{class:"v-data-table__thead",role:"rowgroup"},[(0,l.Wm)(c.I,(0,l.dG)(i,{sticky:e.fixedHeader}),o)]),o.thead?.(R.value),(0,l.Wm)("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[o["body.prepend"]?.(R.value),o.body?o.body(R.value):(0,l.Wm)(m.f,(0,l.dG)(a,n,{items:E.value}),o),o["body.append"]?.(R.value)]),o.tbody?.(R.value),o.tfoot?.(R.value)]),bottom:()=>o.bottom?o.bottom(R.value):(0,l.Wm)(u.i,t,{prepend:o["footer.prepend"]})})}))}});var U=a(3601),I=a(9166),B=a(7396);const O=(0,x.U)({...(0,I.l)(),...(0,B.GB)()},"VLayout"),D=(0,C.ev)()({name:"VLayout",props:O(),setup(e,t){let{slots:a}=t;const{layoutClasses:o,layoutStyles:i,getLayoutItem:n,items:s,layoutRef:r}=(0,B.te)(e);return(0,P.L)((()=>(0,l.Wm)("div",{ref:r,class:[o.value,e.class],style:[i.value,e.style]},[a.default?.()]))),{getLayoutItem:n,items:s}}});var H=a(4286);function j(e,t,a,u,c,m){const p=(0,l.up)("ListButtons"),h=(0,l.up)("ImportExport"),g=(0,l.up)("BulkEdit"),f=(0,l.up)("draggable");return(0,l.wg)(),(0,l.j4)(D,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,{modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selected=t),headers:m.activeHeaders,items:e.data.data,"item-value":"id","show-select":"","onClick:row":m.rowClick,loading:e.loading,"onUpdate:options":m.loadItems,"items-length":e.totalItems,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[2]||(t[2]=t=>e.itemsPerPage=t),search:e.search,"fixed-header":"","fixed-footer":"",class:"data-table-server",page:e.page},{top:(0,l.w5)((()=>[(0,l.Wm)(H.C,{color:"secondary",class:"w-100"},{default:(0,l.w5)((()=>[a.hidebuttons?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(p,{key:0,selected:e.selected,section:e.internalSection,onChangeFields:t[0]||(t[0]=t=>e.dialog=!0),onAction:m.actionHandler,vars:a.vars,sortable:m.isSortable,data:e.buttonData},null,8,["selected","section","onAction","vars","sortable","data"]))])),_:1})])),bottom:(0,l.w5)((()=>[])),_:1},8,["modelValue","headers","items","onClick:row","loading","onUpdate:options","items-length","items-per-page","search","page"]),(0,l.Wm)(h,{ref:"importExport",headers:e.headers,section:e.internalSection,fields:a.searchparams,columns:e.selectedHeaders,onReload:m.reload},null,8,["headers","section","fields","columns","onReload"]),(0,l.Wm)(g,{ref:"bulkEdit",section:e.internalSection,fields:e.data?.fields,onAction:m.actionHandler,vars:a.vars},null,8,["section","fields","onAction","vars"]),(0,l.Wm)(U.B,{modelValue:e.dialog,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dialog=t),"max-width":"600",scrollable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(n._,{title:"Fields"},{default:(0,l.w5)((()=>[(0,l.Wm)(d.y_,{modelValue:e.selectedHeaders,"onUpdate:modelValue":t[3]||(t[3]=t=>e.selectedHeaders=t),headers:[{title:"Field",key:"title"}],items:e.headers,"item-value":"key","items-per-page":"-1","show-select":""},{bottom:(0,l.w5)((()=>[])),_:1},8,["modelValue","items"])])),_:1})])),_:1},8,["modelValue"]),(0,l.Wm)(U.B,{modelValue:e.sortableDialog,"onUpdate:modelValue":t[8]||(t[8]=t=>e.sortableDialog=t),"max-width":"600",scrollable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(n._,{title:"Sort Order",loading:e.sortOrderLoading},{default:(0,l.w5)((()=>[(0,l.Wm)(s.Z,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,{modelValue:e.sortOrder,"onUpdate:modelValue":t[5]||(t[5]=t=>e.sortOrder=t),group:"items",onStart:t[6]||(t[6]=t=>e.drag=!0),onEnd:t[7]||(t[7]=t=>e.drag=!1),"item-key":"id"},{item:(0,l.w5)((({element:e})=>[(0,l.Wm)(H.C,{color:"primary",class:"ma-5 pa-5"},{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(e.title),1)])),_:2},1024)])),_:1},8,["modelValue"])])),_:1}),(0,l.Wm)(r.h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(i.T,{variant:"flat",color:"primary",onClick:m.saveSortOrder},{default:(0,l.w5)((()=>[(0,l.Uk)("Save")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:1})}a(560);var $=a(1006),E=a(2564),T=a(5410),Z=a.n(T),L=a(8346),A=a(6983),F=a.n(A),N=a(7771),q=a(3121),G=a(240);const J={key:1},R=(0,l._)("h4",null,"Match up the fields",-1);function Y(e,t,a,o,d,u){return(0,l.wg)(),(0,l.j4)(U.B,{modelValue:e.importDialog,"onUpdate:modelValue":t[1]||(t[1]=t=>e.importDialog=t),"max-width":"600",scrollable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(n._,{title:"Import"},{default:(0,l.w5)((()=>[(0,l.Wm)(s.Z,null,{default:(0,l.w5)((()=>[e.error?((0,l.wg)(),(0,l.j4)(N.w,{key:0,text:e.error,type:"error"},null,8,["text"])):(0,l.kq)("",!0),(0,l.Wm)(q.Z,{modelValue:e.file,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.file=t),u.readFile],label:"CSV file"},null,8,["modelValue","onUpdate:modelValue"]),e.importHeaders.length?((0,l.wg)(),(0,l.iD)("div",J,[R,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.headers,((t,a)=>((0,l.wg)(),(0,l.iD)("div",{key:a},[(0,l.Wm)(G.rL,{items:e.importHeaders,label:t.title,modelValue:e.importCols[t.key],"onUpdate:modelValue":a=>e.importCols[t.key]=a},null,8,["items","label","modelValue","onUpdate:modelValue"])])))),128))])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(r.h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(i.T,{onClick:u.doImport,variant:"flat",color:"primary",disabled:!e.importHeaders.length},{default:(0,l.w5)((()=>[(0,l.Uk)("Import")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var z={props:{headers:null,section:null,fields:null,columns:null},data:function(){return{error:"",importDialog:!1,importHeaders:[],importCols:{}}},methods:{openImport:function(){this.importDialog=!0},doImport:async function(){const e=new FormData;for(const[a,l]of Object.entries(this.importCols))e.append("fields["+a+"]",l);e.append("file",this.file[0]),this.error="",this.loading=!0;const t=await $.Z.post("?cmd=import&section="+this.internalSection,e,{headers:{"Content-Type":"multipart/form-data"}});this.loading=!1,t.data.error?this.error=t.data?.error:(this.importDialog=!1,this.$emit("reload"))},readFile:function(){const e=new FileReader;e.onload=e=>{const t=e.target.result,a=t.split("\n");let l=[],o=a[0].split(",");for(let n=0;n<o.length;n++){const e=o[n].trim();e.startsWith('"')&&e.endsWith('"')?l.push(e.slice(1,-1)):l.push(e)}let i=[];o=a[1].split(",");for(let n=0;n<o.length;n++){const e=o[n].trim();e.startsWith('"')&&e.endsWith('"')?i.push(e.slice(1,-1)):i.push(e)}this.importHeaders=[],l.forEach(((e,t)=>{this.importHeaders.push({value:t,raw:e,title:e+" - "+i[t]})})),this.importCols={},this.headers.forEach((e=>{let t=this.importHeaders.find((t=>t.raw===e.key));this.importCols[e.key]=t?t.value:""}))},e.readAsText(this.file[0])},exportItems:function(){let e={cmd:"export",section:this.section,fields:this.fields,columns:this.columns};const t=Z().stringify(e);window.open($.Z.getApiRoot()+"?"+t)}}},M=a(89);const K=(0,M.Z)(z,[["render",Y]]);var Q=K,X=a(2650),ee=a(1222),te=a(9457),ae=a(165);function le(e,t,a,o,d,u){return(0,l.wg)(),(0,l.j4)(U.B,{modelValue:e.dialog,"onUpdate:modelValue":t[0]||(t[0]=t=>e.dialog=t),"max-width":"600",scrollable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(n._,{title:"Bulk edit"},{default:(0,l.w5)((()=>[(0,l.Wm)(s.Z,null,{default:(0,l.w5)((()=>[e.error?((0,l.wg)(),(0,l.j4)(N.w,{key:0,text:e.error,type:"error"},null,8,["text"])):(0,l.kq)("",!0),((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(a.fields,(t=>((0,l.wg)(),(0,l.iD)(l.HY,{key:t.type},[["id"].includes(t.type)?(0,l.kq)("",!0):((0,l.wg)(),(0,l.j4)(te.l,{key:0},{prepend:(0,l.w5)((()=>[(0,l.Wm)(ee.x,{modelValue:e.enabled[t.column],"onUpdate:modelValue":a=>e.enabled[t.column]=a},null,8,["modelValue","onUpdate:modelValue"])])),default:(0,l.w5)((()=>[["checkbox"].includes(t.type)?((0,l.wg)(),(0,l.j4)(ee.x,{key:0,label:u.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,disabled:!e.enabled[t.column]},null,8,["label","modelValue","onUpdate:modelValue","disabled"])):["select"].includes(t.type)?((0,l.wg)(),(0,l.j4)(G.rL,{key:1,label:u.formatString(t.column),items:e.options[t.column],modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,disabled:!e.enabled[t.column]},null,8,["label","items","modelValue","onUpdate:modelValue","disabled"])):["select_multiple"].includes(t.type)?((0,l.wg)(),(0,l.j4)(G.rL,{key:2,label:u.formatString(t.column),items:e.options[t.column],modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,multiple:"",chips:"",disabled:!e.enabled[t.column]},{prepend:(0,l.w5)((()=>[(0,l.Wm)(G.rL,{modelValue:e.param.func[t.column],"onUpdate:modelValue":a=>e.param.func[t.column]=a,items:["in","not in"],"hide-details":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1032,["label","items","modelValue","onUpdate:modelValue","disabled"])):"combo"===t.type?((0,l.wg)(),(0,l.j4)(X.f,{key:3,label:u.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,items:e.options[t.column],"onUpdate:search":e=>u.updateCombo(e,t.column),disabled:!e.enabled[t.column]},null,8,["label","modelValue","onUpdate:modelValue","items","onUpdate:search","disabled"])):((0,l.wg)(),(0,l.j4)(ae.h,{key:4,label:u.formatString(t.column),modelValue:e.params[t.column],"onUpdate:modelValue":a=>e.params[t.column]=a,disabled:!e.enabled[t.column]},null,8,["label","modelValue","onUpdate:modelValue","disabled"]))])),_:2},1024))],64)))),128))])),_:1}),(0,l.Wm)(r.h,null,{default:(0,l.w5)((()=>[(0,l.Wm)(i.T,{onClick:u.save,variant:"flat",color:"primary",disabled:!u.hasChanges},{default:(0,l.w5)((()=>[(0,l.Uk)("Save")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"])}var oe={props:{section:null,fields:null,vars:null},data:function(){return{dialog:!1,error:"",params:{},enabled:{},options:{}}},methods:{open:async function(){this.options=await E.Z.getAllOptions(this.fields,this.vars,this.section,{}),this.dialog=!0},formatString:function(e){return E.Z.formatString(e)},save:function(){this.$emit("action","bulkedit",{data:this.params})},updateCombo:async function(e,t){const a=await $.Z.get("?cmd=autocomplete&field="+t+"&term="+e);this.options[t]=a.data}},computed:{hasChanges:function(){return Object.values(this.enabled).filter((e=>!0===e)).length>0}}};const ie=(0,M.Z)(oe,[["render",le]]);var ne=ie,se={components:{ListButtons:L.Z,draggable:F(),ImportExport:Q,BulkEdit:ne},props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null},data:function(){return{dialog:!1,selectedHeaders:[],headers:[],selected:[],data:{},internalSection:"",loading:!1,sortableDialog:!1,totalItems:0,itemsPerPage:20,page:1,search:"",drag:!1,sortOrder:[],sortOrderLoading:!1,file:[],filter:"",buttonData:{}}},methods:{formatString:function(e){return E.Z.formatString(e)},loadItems:async function({page:e,itemsPerPage:t,sortBy:a}){let l=this.searchparams;this.filter&&(l["s"]=this.filter);let o={cmd:"get",section:this.internalSection,fields:l,page:e,itemsPerPage:t,sortBy:a};this.parentsection&&(o.parentsection=this.parentsection),this.parentid&&(o.parentid=this.parentid);const i=Z().stringify(o);this.loading=!0;let n={};try{n=await $.Z.get("?"+i.toString(),o)}catch(u){console.log(u)}if(this.loading=!1,!n.data?.fields)return!1;n.data.data||(n.data.data=[],n.data.total=0),n.data.data.forEach((e=>{for(const[,t]of Object.entries(n.data.fields))e[t.column+"_label"]?e[t.column]=e[t.column+"_label"]:e[t.column]=E.Z.formatData(e[t.column],t.type)})),this.data=n.data,this.totalItems=this.data.total,this.buttonData={page:e,itemsPerPage:t,totalItems:this.totalItems},this.headers=[];let s=Object.values(n.data.fields);if(s.length&&!s.find((e=>"id"===e.column))){let e=E.Z.base();return this.$router.push(e+"section/"+this.internalSection+"/1/"),!1}for(const[,c]of Object.entries(this.data.fields))this.headers.push({title:this.formatString(c.column),key:c.column});let r=s.map((e=>e.column));this.selectedHeaders.length||(this.selectedHeaders=r),this.$emit("changeHeaders",s),this.sortOrder=[],this.isSortable&&(this.data.data.forEach((e=>{let t=Object.keys(e)[0];this.sortOrder.push({title:t+": "+e[t],id:e.id,position:e.position})})),this.sortOrder.sort(((e,t)=>e.position-t.position)));let d=this.vars?.branding?.title?this.vars.branding.title:"ADMIN";document.title=d+" | "+this.internalSection,this.$emit("loaded")},rowClick:function(e,t){let a="/";this.$route.params.base&&(a+=this.$route.params.base+"/");let l=a+"section/"+this.internalSection+"/"+t.item.id+"/";this.parentsection&&(l+="?parentsection="+this.parentsection+"&parentid="+this.parentid),this.$router.push(l)},actionHandler:async function(e){let t={};if("export"===e)return void this.$refs["importExport"].exportItems();if("import"===e)return void this.$refs["importExport"].openImport();if("openBulkEdit"===e)return void this.$refs["bulkEdit"].open();if("openSortable"===e)return void(this.sortableDialog=!0);if("filter"===e)return this.filter=arguments[1],void this.reload();if("prevPage"===e){if(1===this.page)return;return void this.page--}if("nextPage"===e){if(this.page*this.itemsPerPage>=this.totalItems)return;return void this.page++}if("string"===typeof e)return t={cmd:e,section:this.internalSection,ids:this.selected},"object"===typeof arguments[1]&&(t={...t,...arguments[1]}),this.loading=!0,await $.Z.post("?cmd="+e+"&section="+this.internalSection,t),void this.reload();t={cmd:"button",button:e.id,section:this.internalSection,ids:this.selected},this.loading=!0;const a=await $.Z.post("?cmd=button&section="+this.internalSection,t);this.loading=!1,a.data.error&&alert(a.data.error),a.data.result?.redirect?e.target?window.open(a.data.result.redirect):location.href=a.data.result.redirect:this.reload()},saveSortOrder:async function(){let e={cmd:"reorder",section:this.section,items:this.sortOrder};this.sortOrderLoading=!0,await $.Z.post("?cmd=reorder&section="+this.internalSection,e),this.sortOrderLoading=!1,this.sortableDialog=!1,this.reload()},reload:function(){this.search=String(Date.now())}},watch:{$route(e){this.internalSection=e.params.section,this.reload()},section:function(e){this.internalSection=e,this.reload()},selectedHeaders:function(e){localStorage["fields_"+this.internalSection]=JSON.stringify(Object.values(e))},searchparams:function(){this.reload()},headers:function(e){let t=localStorage["fields_"+this.internalSection],a=t?JSON.parse(t):e.map((e=>e.key)),l=e.map((e=>e.key));a=a.filter((e=>l.includes(e))),JSON.stringify(a)!==JSON.stringify(this.selectedHeaders)&&(this.selectedHeaders=a);let o=[];this.selectedHeaders.forEach((e=>{for(const[,t]of Object.entries(this.data.fields))e===t.column&&o.push(t)})),this.$emit("changeFields",o)}},computed:{activeHeaders:function(){let e=[];return this.selectedHeaders.forEach((t=>{e.push({title:this.formatString(t),value:t,sortable:!0})})),e},isSortable:function(){let e=!1;return this.data.fields&&Object.values(this.data.fields).forEach((t=>{"position"===t.type&&(e=!0)})),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section,localStorage["fields_"+this.internalSection]&&(this.selectedHeaders=JSON.parse(localStorage["fields_"+this.internalSection]))}};const re=(0,M.Z)(se,[["render",j]]);var de=re}}]);
//# sourceMappingURL=729.2949a8a1.js.map