"use strict";(self["webpackChunkshiftadmin"]=self["webpackChunkshiftadmin"]||[]).push([[726],{1793:function(e,t,a){a.d(t,{Z:function(){return v}});var i=a(3396),o=a(7139),s=a(870),l=a(1055),r=a(6052),n=a(9457),d=a(2127),c=a(4193),u=a(165);const m={class:"d-flex"};function h(e,t,a,h,p,g){return(0,i.wg)(),(0,i.iD)("span",m,[(0,i.Wm)(s.T,{variant:"text",title:"Add",icon:"mdi-plus",to:g.base+"section/"+e.internalSection+"/add"+(a.parentsection?"?parentsection="+a.parentsection+"&parentid="+a.parentid:"")},null,8,["to"]),(0,i.Wm)(s.T,{variant:"text",title:"Fields",icon:"mdi-view-column",onClick:g.changeFields},null,8,["onClick"]),a.selected.length?((0,i.wg)(),(0,i.j4)(s.T,{key:0,variant:"text",title:"Delete",icon:"mdi-delete",onClick:t[0]||(t[0]=e=>g.doAction("delete"))})):(0,i.kq)("",!0),(0,i.Wm)(s.T,{variant:"text",title:"Import",icon:"mdi-import",onClick:g.openImport},null,8,["onClick"]),(0,i.Wm)(s.T,{variant:"text",title:"Export",icon:"mdi-export",onClick:g.exportItems},null,8,["onClick"]),a.sortable?((0,i.wg)(),(0,i.j4)(s.T,{key:1,variant:"text",title:"Sort",icon:"mdi-sort",onClick:t[1]||(t[1]=e=>g.doAction("openSortable"))})):(0,i.kq)("",!0),g.buttons.length?((0,i.wg)(),(0,i.j4)(c.T,{key:2},{activator:(0,i.w5)((({props:e})=>[(0,i.Wm)(s.T,(0,i.dG)({variant:"text"},e,{icon:"mdi-dots-vertical"}),null,16)])),default:(0,i.w5)((()=>[(0,i.Wm)(r.i,null,{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(g.buttons,((e,t)=>((0,i.wg)(),(0,i.j4)(n.l,{key:t,value:t,onClick:t=>g.customButton(e)},{default:(0,i.w5)((()=>[(0,i.Wm)(d.V,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,o.zw)(e.label),1)])),_:2},1024)])),_:2},1032,["value","onClick"])))),128))])),_:1})])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(l.C),(0,i.Wm)(u.h,{modelValue:e.filter,"onUpdate:modelValue":t[2]||(t[2]=t=>e.filter=t),"hide-details":"",placeholder:"Filter",density:"compact"},null,8,["modelValue"])])}a(560);var p={props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null,selected:null,data:null,headers:null,sortable:Boolean},data:function(){return{dialog:!1,selectedHeaders:[],internalSection:"",loading:!1,filter:""}},methods:{formatString:function(e){return e=e.replace(/_/g," "),e.charAt(0).toUpperCase()+e.slice(1)},doAction:async function(e){this.$emit("action",e)},exportItems:function(){this.$emit("action","export")},changeFields:function(){this.$emit("changeFields")},customButton:function(e){this.$emit("action",e)},openImport:function(){this.$emit("action","import")}},watch:{section:function(e){this.internalSection=e},filter:function(e){this.$emit("action","filter",e)}},computed:{buttons:function(){var e=[];return this.vars?.buttons?.forEach(((t,a)=>{"list"===t.page&&t.section===this.internalSection&&(t.id=a,e.push(t))})),e},base(){let e="/";return this.$route.params.base&&(e+=this.$route.params.base+"/"),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section}},g=a(89);const f=(0,g.Z)(p,[["render",h]]);var v=f},6726:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var i=a(3396),o=a(7139),s=a(7771),l=a(870),r=a(1489),n=a(1888),d=a(1334),c=a(6658),u=a(2934),m=a(2804),h=a(461),p=a(1231),g=a(7471),f=a(6969),v=a(8829),y=a(3890),b=a(7609),w=a(9207),S=a(2651),k=a(2864),V=a(6107),x=a(4870),W=a(3766),_=a(1107),C=a(9888);const P=(0,W.U)({itemsLength:{type:[Number,String],required:!0},...(0,w.Gj)(),...(0,c.Sz)(),...(0,u.p)()},"VDataTableServer"),I=(0,_.ev)()({name:"VDataTableServer",props:P(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,t){let{attrs:a,slots:o}=t;const{groupBy:s}=(0,f.my)(e),{sortBy:l,multiSort:r,mustSort:n}=(0,k.lx)(e),{page:d,itemsPerPage:c}=(0,w.FV)(e),W=(0,i.Fl)((()=>parseInt(e.itemsLength,10))),{columns:_,headers:P}=(0,v.IT)(e,{groupBy:s,showSelect:(0,x.Vh)(e,"showSelect"),showExpand:(0,x.Vh)(e,"showExpand")}),{items:I}=(0,y.hh)(e,_),{toggleSort:H}=(0,k.NV)({sortBy:l,multiSort:r,mustSort:n,page:d}),{opened:O,isGroupOpen:D,toggleGroup:B,extractRows:T}=(0,f.P_)({groupBy:s,sortBy:l}),{pageCount:U,setItemsPerPage:F}=(0,w.ku)({page:d,itemsPerPage:c,itemsLength:W}),{flatItems:$}=(0,f.T5)(I,s,O),{isSelected:j,select:E,selectAll:L,toggleSelect:Z,someSelected:A,allSelected:G}=(0,S.mH)(e,{allItems:I,currentPage:I}),{isExpanded:N,toggleExpand:q}=(0,g.BM)(e),J=(0,i.Fl)((()=>T(I.value)));(0,b.D)({page:d,itemsPerPage:c,sortBy:l,groupBy:s,search:(0,x.Vh)(e,"search")}),(0,i.JJ)("v-data-table",{toggleSort:H,sortBy:l}),(0,V.AF)({VDataTableRows:{hideNoData:(0,x.Vh)(e,"hideNoData"),noDataText:(0,x.Vh)(e,"noDataText"),loading:(0,x.Vh)(e,"loading"),loadingText:(0,x.Vh)(e,"loadingText")}});const R=(0,i.Fl)((()=>({page:d.value,itemsPerPage:c.value,sortBy:l.value,pageCount:U.value,toggleSort:H,setItemsPerPage:F,someSelected:A.value,allSelected:G.value,isSelected:j,select:E,selectAll:L,toggleSelect:Z,isExpanded:N,toggleExpand:q,isGroupOpen:D,toggleGroup:B,items:J.value.map((e=>e.raw)),internalItems:J.value,groupedItems:$.value,columns:_.value,headers:P.value})));(0,C.L)((()=>{const t=u.i.filterProps(e),s=m.I.filterProps(e),l=h.f.filterProps(e),r=p.Y.filterProps(e);return(0,i.Wm)(p.Y,(0,i.dG)({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},r),{top:()=>o.top?.(R.value),default:()=>o.default?o.default(R.value):(0,i.Wm)(i.HY,null,[o.colgroup?.(R.value),(0,i.Wm)("thead",{class:"v-data-table__thead",role:"rowgroup"},[(0,i.Wm)(m.I,(0,i.dG)(s,{sticky:e.fixedHeader}),o)]),o.thead?.(R.value),(0,i.Wm)("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[o["body.prepend"]?.(R.value),o.body?o.body(R.value):(0,i.Wm)(h.f,(0,i.dG)(a,l,{items:$.value}),o),o["body.append"]?.(R.value)]),o.tbody?.(R.value),o.tfoot?.(R.value)]),bottom:()=>o.bottom?o.bottom(R.value):(0,i.Wm)(u.i,t,{prepend:o["footer.prepend"]})})}))}});var H=a(3601),O=a(3121),D=a(9166),B=a(7396);const T=(0,W.U)({...(0,D.l)(),...(0,B.GB)()},"VLayout"),U=(0,_.ev)()({name:"VLayout",props:T(),setup(e,t){let{slots:a}=t;const{layoutClasses:o,layoutStyles:s,getLayoutItem:l,items:r,layoutRef:n}=(0,B.te)(e);return(0,C.L)((()=>(0,i.Wm)("div",{ref:n,class:[o.value,e.class],style:[s.value,e.style]},[a.default?.()]))),{getLayoutItem:l,items:r}}});var F=a(240),$=a(4286);const j={key:1},E=(0,i._)("h4",null,"Match up the fields",-1);function L(e,t,a,u,m,h){const p=(0,i.up)("ListButtons"),g=(0,i.up)("draggable");return(0,i.wg)(),(0,i.j4)(U,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{modelValue:e.selected,"onUpdate:modelValue":t[1]||(t[1]=t=>e.selected=t),headers:h.activeHeaders,items:e.data.data,"item-value":"id","show-select":"","onClick:row":h.rowClick,loading:e.loading,"onUpdate:options":h.loadItems,"items-length":e.totalItems,"items-per-page":e.itemsPerPage,"onUpdate:itemsPerPage":t[2]||(t[2]=t=>e.itemsPerPage=t),search:e.search,"fixed-header":"","fixed-footer":"",class:"data-table-server"},{top:(0,i.w5)((()=>[(0,i.Wm)($.C,{color:"secondary",style:{position:"fixed","z-index":"100"},class:"w-100"},{default:(0,i.w5)((()=>[a.hidebuttons?(0,i.kq)("",!0):((0,i.wg)(),(0,i.j4)(p,{key:0,selected:e.selected,section:e.internalSection,onChangeFields:t[0]||(t[0]=t=>e.dialog=!0),onAction:h.actionHandler,vars:a.vars,sortable:h.isSortable},null,8,["selected","section","onAction","vars","sortable"]))])),_:1})])),_:1},8,["modelValue","headers","items","onClick:row","loading","onUpdate:options","items-length","items-per-page","search"]),(0,i.Wm)(H.B,{modelValue:e.importDialog,"onUpdate:modelValue":t[4]||(t[4]=t=>e.importDialog=t),"max-width":"600",scrollable:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r._,{title:"Import"},{default:(0,i.w5)((()=>[(0,i.Wm)(n.Z,null,{default:(0,i.w5)((()=>[e.error?((0,i.wg)(),(0,i.j4)(s.w,{key:0,text:e.error,type:"error"},null,8,["text"])):(0,i.kq)("",!0),(0,i.Wm)(O.Z,{modelValue:e.file,"onUpdate:modelValue":[t[3]||(t[3]=t=>e.file=t),h.readFile],label:"CSV file"},null,8,["modelValue","onUpdate:modelValue"]),e.importHeaders.length?((0,i.wg)(),(0,i.iD)("div",j,[E,((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.headers,((t,a)=>((0,i.wg)(),(0,i.iD)("div",{key:a},[(0,i.Wm)(F.rL,{items:e.importHeaders,label:t.title,modelValue:e.importCols[t.key],"onUpdate:modelValue":a=>e.importCols[t.key]=a},null,8,["items","label","modelValue","onUpdate:modelValue"])])))),128))])):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(d.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(l.T,{onClick:h.doImport,variant:"flat",color:"primary",disabled:!e.importHeaders.length},{default:(0,i.w5)((()=>[(0,i.Uk)("Import")])),_:1},8,["onClick","disabled"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(H.B,{modelValue:e.dialog,"onUpdate:modelValue":t[6]||(t[6]=t=>e.dialog=t),"max-width":"600",scrollable:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r._,{title:"Fields"},{default:(0,i.w5)((()=>[(0,i.Wm)(c.y_,{modelValue:e.selectedHeaders,"onUpdate:modelValue":t[5]||(t[5]=t=>e.selectedHeaders=t),headers:[{title:"Field",key:"title"}],items:e.headers,"item-value":"key","items-per-page":"-1","show-select":""},{bottom:(0,i.w5)((()=>[])),_:1},8,["modelValue","items"])])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(H.B,{modelValue:e.sortableDialog,"onUpdate:modelValue":t[10]||(t[10]=t=>e.sortableDialog=t),"max-width":"600",scrollable:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r._,{title:"Sort Order",loading:e.sortOrderLoading},{default:(0,i.w5)((()=>[(0,i.Wm)(n.Z,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{modelValue:e.sortOrder,"onUpdate:modelValue":t[7]||(t[7]=t=>e.sortOrder=t),group:"items",onStart:t[8]||(t[8]=t=>e.drag=!0),onEnd:t[9]||(t[9]=t=>e.drag=!1),"item-key":"id"},{item:(0,i.w5)((({element:e})=>[(0,i.Wm)($.C,{color:"primary",class:"ma-5 pa-5"},{default:(0,i.w5)((()=>[(0,i.Uk)((0,o.zw)(e.title),1)])),_:2},1024)])),_:1},8,["modelValue"])])),_:1}),(0,i.Wm)(d.h,null,{default:(0,i.w5)((()=>[(0,i.Wm)(l.T,{variant:"flat",color:"primary",onClick:h.saveSortOrder},{default:(0,i.w5)((()=>[(0,i.Uk)("Save")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["loading"])])),_:1},8,["modelValue"])])),_:1})}a(560);var Z=a(1006),A=a(2564),G=a(5410),N=a.n(G),q=a(1793),J=a(6983),R=a.n(J),Y={components:{ListButtons:q.Z,draggable:R()},props:{vars:null,section:null,hidebuttons:Boolean,parentsection:null,parentid:null,searchparams:null},data:function(){return{dialog:!1,selectedHeaders:[],selected:[],data:[],internalSection:"",loading:!1,importDialog:!1,importHeaders:[],importCols:{},sortableDialog:!1,totalItems:0,itemsPerPage:20,search:"",headers:[],drag:!1,sortOrder:[],sortOrderLoading:!1,file:[],error:"",filter:""}},methods:{formatString:function(e){return A.Z.formatString(e)},loadItems:async function({page:e,itemsPerPage:t,sortBy:a}){let i=this.searchparams;this.filter&&(i["s"]=this.filter);var o={cmd:"get",section:this.internalSection,fields:i,page:e,itemsPerPage:t,sortBy:a};this.parentsection&&(o.parentsection=this.parentsection),this.parentid&&(o.parentid=this.parentid);const s=N().stringify(o);this.loading=!0;let l={};try{l=await Z.Z.get("?"+s.toString(),o)}catch(d){console.log(d)}if(this.loading=!1,!l.data?.fields)return!1;l.data.data||(l.data.data=[],l.data.total=0),l.data.data.forEach((e=>{for(const[,t]of Object.entries(l.data.fields))e[t.column+"_label"]?e[t.column]=e[t.column+"_label"]:e[t.column]=A.Z.formatData(e[t.column],t.type)})),this.data=l.data,this.totalItems=this.data.total,this.headers=[];let r=Object.values(l.data.fields);if(r.length&&!r.find((e=>"id"===e.column)))return this.$router.push(this.base+"section/"+this.internalSection+"/1/"),!1;for(const[,c]of Object.entries(this.data.fields))this.headers.push({title:this.formatString(c.column),key:c.column});let n=r.map((e=>e.column));this.selectedHeaders.length||(this.selectedHeaders=n),this.$emit("changeHeaders",r),this.sortOrder=[],this.isSortable&&(this.data.data.forEach((e=>{let t=Object.keys(e)[0];this.sortOrder.push({title:t+": "+e[t],id:e.id,position:e.position})})),this.sortOrder.sort(((e,t)=>e.position-t.position)))},rowClick:function(e,t){let a="/";this.$route.params.base&&(a+=this.$route.params.base+"/");let i=a+"section/"+this.internalSection+"/"+t.item.id+"/";this.parentsection&&(i+="?parentsection="+this.parentsection+"&parentid="+this.parentid),this.$router.push(i)},doAction:async function(e){var t={cmd:e,section:this.section,ids:this.selected};this.loading=!0,await Z.Z.post("?cmd="+e+"&section="+this.internalSection,t),this.selected=[],this.reload()},actionHandler:async function(e){let t={};if("export"===e)return void this.exportItems();if("import"===e)return void this.openImport();if("openSortable"===e)return void(this.sortableDialog=!0);if("filter"===e)return this.filter=arguments[1],void this.reload();if("string"===typeof e)return t={cmd:e,section:this.internalSection,ids:this.selected},this.loading=!0,await Z.Z.post("?cmd="+e+"&section="+this.internalSection,t),void this.reload();t={cmd:"button",button:e.id,section:this.internalSection,ids:this.selected},this.loading=!0;const a=await Z.Z.post("?cmd=button&section="+this.internalSection,t);this.loading=!1,a.data.error&&alert(a.data.error),a.data.result?.redirect?e.target?window.open(a.data.result.redirect):location.href=a.data.result.redirect:this.reload()},exportItems:function(){var e={cmd:"export",section:this.internalSection,fields:this.searchparams,columns:this.activeHeaders.map((e=>e.key))};this.parentsection&&(e.parentsection=this.parentsection),this.parentid&&(e.parentid=this.parentid);const t=N().stringify(e);window.open(Z.Z.getApiRoot()+"?"+t)},openImport:function(){this.importDialog=!0},doImport:async function(){const e=new FormData;for(const[a,i]of Object.entries(this.importCols))e.append("fields["+a+"]",i);e.append("file",this.file[0]),this.error="",this.loading=!0;const t=await Z.Z.post("?cmd=import&section="+this.internalSection,e,{headers:{"Content-Type":"multipart/form-data"}});this.loading=!1,t.data.error?this.error=t.data?.error:(this.importDialog=!1,this.reload())},saveSortOrder:async function(){var e={cmd:"reorder",section:this.section,items:this.sortOrder};this.sortOrderLoading=!0,await Z.Z.post("?cmd=reorder&section="+this.internalSection,e),this.sortOrderLoading=!1,this.sortableDialog=!1,this.reload()},reload:function(){this.search=String(Date.now())},readFile:function(){const e=new FileReader;e.onload=e=>{const t=e.target.result,a=t.split("\n");let i=[],o=a[0].split(",");for(let l=0;l<o.length;l++){const e=o[l].trim();e.startsWith('"')&&e.endsWith('"')?i.push(e.slice(1,-1)):i.push(e)}let s=[];o=a[1].split(",");for(let l=0;l<o.length;l++){const e=o[l].trim();e.startsWith('"')&&e.endsWith('"')?s.push(e.slice(1,-1)):s.push(e)}this.importHeaders=[],i.forEach(((e,t)=>{this.importHeaders.push({value:t,raw:e,title:e+" - "+s[t]})})),this.importCols={},this.headers.forEach((e=>{let t=this.importHeaders.find((t=>t.raw===e.key));this.importCols[e.key]=t?t.value:""}))},e.readAsText(this.file[0])}},watch:{$route(e){this.internalSection=e.params.section,this.reload()},section:function(e){this.internalSection=e,this.reload()},selectedHeaders:function(e){localStorage["fields_"+this.internalSection]=JSON.stringify(Object.values(e))},searchparams:function(){this.reload()},headers:function(e){let t=localStorage["fields_"+this.internalSection],a=t?JSON.parse(t):e.map((e=>e.key)),i=e.map((e=>e.key));a=a.filter((e=>i.includes(e))),JSON.stringify(a)!==JSON.stringify(this.selectedHeaders)&&(this.selectedHeaders=a);var o=[];this.selectedHeaders.forEach((e=>{for(const[,t]of Object.entries(this.data.fields))e===t.column&&o.push(t)})),this.$emit("changeFields",o)},vars:function(){}},computed:{activeHeaders:function(){var e=[];return this.selectedHeaders.forEach((t=>{e.push({title:this.formatString(t),value:t,sortable:!0})})),e},isSortable:function(){let e=!1;return this.data.fields&&Object.values(this.data.fields).forEach((t=>{"position"===t.type&&(e=!0)})),e}},created(){this.internalSection=this.section?this.section:this.$route.params.section,localStorage["fields_"+this.internalSection]&&(this.selectedHeaders=JSON.parse(localStorage["fields_"+this.internalSection]))},mounted(){this.hidebuttons||(document.title="ADMIN | "+this.internalSection)}},z=a(89);const M=(0,z.Z)(Y,[["render",L]]);var K=M}}]);
//# sourceMappingURL=726.fa435267.js.map